<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOONLANGUAGE | 9 Visionary Perspectives</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* MOONLANGUAGE Color System */
            --void-black: #000000;
            --deep-space: #0a0a0f;
            --cosmic-dark: #12121a;
            --nebula-purple: #1a1a2e;

            /* Lunar Palette */
            --moon-silver: #c0c0c0;
            --moon-glow: #e8e8f0;
            --moon-bright: #ffffff;

            /* Energy Colors */
            --tesla-electric: #00d4ff;
            --davinci-gold: #d4af37;
            --hildegard-rose: #ff6b9d;
            --fuller-green: #00ff88;
            --jung-purple: #9b59b6;
            --suleyman-cyan: #00bcd4;
            --grant-violet: #8b5cf6;
            --florez-magenta: #ff00ff;

            /* Accent */
            --cosmic-gold: #ffd700;
            --starlight: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--void-black);
            color: var(--moon-glow);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Navigation */
        .vision-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
            padding: 1rem 2rem;
        }

        .vision-nav h1 {
            font-size: 0.8rem;
            letter-spacing: 0.3em;
            color: var(--moon-silver);
            text-align: center;
            margin-bottom: 1rem;
        }

        .vision-tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .vision-tab {
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            color: var(--moon-silver);
            cursor: pointer;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            transition: all 0.3s ease;
        }

        .vision-tab:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--cosmic-gold);
        }

        .vision-tab.active {
            background: var(--cosmic-gold);
            color: var(--void-black);
            border-color: var(--cosmic-gold);
        }

        /* Canvas Container */
        .canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #webgl-canvas {
            width: 100%;
            height: 100%;
        }

        /* Vision Info Panel */
        .vision-info {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            right: 2rem;
            z-index: 100;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
        }

        .vision-info h2 {
            font-size: 1.5rem;
            font-weight: 300;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, var(--cosmic-gold), var(--moon-glow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .vision-info .master {
            font-size: 0.8rem;
            color: var(--moon-silver);
            letter-spacing: 0.2em;
            margin-bottom: 1rem;
        }

        .vision-info p {
            font-size: 0.9rem;
            line-height: 1.6;
            color: rgba(255,255,255,0.7);
        }

        .vision-info .quote {
            margin-top: 1rem;
            padding: 1rem;
            border-left: 2px solid var(--cosmic-gold);
            font-style: italic;
            color: var(--moon-glow);
        }

        /* Loading Screen */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--void-black);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease;
        }

        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-orb {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--moon-bright), var(--moon-silver), var(--cosmic-dark));
            box-shadow:
                0 0 60px rgba(255,255,255,0.3),
                inset 0 0 30px rgba(0,0,0,0.5);
            animation: float 3s ease-in-out infinite;
        }

        .loading-text {
            margin-top: 2rem;
            font-size: 0.8rem;
            letter-spacing: 0.3em;
            color: var(--moon-silver);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Ribbon Quote Overlay */
        .ribbon-quote {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 50;
            font-size: 1rem;
            color: rgba(255,255,255,0.1);
            white-space: nowrap;
            animation: ribbonRotate 60s linear infinite;
        }

        @keyframes ribbonRotate {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Magnifier Indicator */
        .magnifier-hint {
            position: fixed;
            top: 50%;
            right: 2rem;
            transform: translateY(-50%);
            z-index: 100;
            writing-mode: vertical-rl;
            font-size: 0.7rem;
            letter-spacing: 0.2em;
            color: var(--moon-silver);
            opacity: 0.5;
        }

        /* Moon Counter */
        .moon-counter {
            position: fixed;
            top: 50%;
            left: 2rem;
            transform: translateY(-50%);
            z-index: 100;
            text-align: center;
        }

        .moon-counter .number {
            font-size: 3rem;
            font-weight: 200;
            color: var(--cosmic-gold);
        }

        .moon-counter .label {
            font-size: 0.6rem;
            letter-spacing: 0.3em;
            color: var(--moon-silver);
        }

        /* Metrics Panel */
        .metrics-panel {
            position: fixed;
            top: 120px;
            right: 2rem;
            z-index: 100;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 1rem;
            min-width: 200px;
        }

        .metric {
            margin-bottom: 1rem;
        }

        .metric:last-child {
            margin-bottom: 0;
        }

        .metric-label {
            font-size: 0.6rem;
            letter-spacing: 0.2em;
            color: var(--moon-silver);
            margin-bottom: 0.3rem;
        }

        .metric-bar {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .metric-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--cosmic-gold), var(--tesla-electric));
            border-radius: 2px;
            transition: width 1s ease;
        }

        .metric-value {
            font-size: 0.8rem;
            color: var(--moon-glow);
            margin-top: 0.2rem;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loading">
        <div class="loading-orb"></div>
        <div class="loading-text">ENTERING MOONLANGUAGE</div>
    </div>

    <!-- Navigation -->
    <nav class="vision-nav">
        <h1>MOONLANGUAGE DESIGN KIT | 9 VISIONARY PERSPECTIVES</h1>
        <div class="vision-tabs">
            <div class="vision-tab active" data-vision="davinci">DA VINCI</div>
            <div class="vision-tab" data-vision="tesla">TESLA</div>
            <div class="vision-tab" data-vision="hildegard">HILDEGARD</div>
            <div class="vision-tab" data-vision="fuller">FULLER</div>
            <div class="vision-tab" data-vision="jung">JUNG</div>
            <div class="vision-tab" data-vision="suleyman">SULEYMAN</div>
            <div class="vision-tab" data-vision="grant">GRANT</div>
            <div class="vision-tab" data-vision="florez">FLOREZ</div>
            <div class="vision-tab" data-vision="unified">UNIFIED</div>
        </div>
    </nav>

    <!-- WebGL Canvas -->
    <div class="canvas-container">
        <canvas id="webgl-canvas"></canvas>
    </div>

    <!-- Moon Counter -->
    <div class="moon-counter">
        <div class="number" id="moon-number">001</div>
        <div class="label">OF 968</div>
    </div>

    <!-- Metrics Panel -->
    <div class="metrics-panel">
        <div class="metric">
            <div class="metric-label">COSMIC RESONANCE</div>
            <div class="metric-bar"><div class="metric-fill" style="width: 78%"></div></div>
            <div class="metric-value">78%</div>
        </div>
        <div class="metric">
            <div class="metric-label">TEMPORAL DEPTH</div>
            <div class="metric-bar"><div class="metric-fill" style="width: 92%"></div></div>
            <div class="metric-value">92%</div>
        </div>
        <div class="metric">
            <div class="metric-label">ACTIVATION ENERGY</div>
            <div class="metric-bar"><div class="metric-fill" style="width: 65%"></div></div>
            <div class="metric-value">65%</div>
        </div>
        <div class="metric">
            <div class="metric-label">MESSAGE CLARITY</div>
            <div class="metric-bar"><div class="metric-fill" style="width: 84%"></div></div>
            <div class="metric-value">84%</div>
        </div>
    </div>

    <!-- Magnifier Hint -->
    <div class="magnifier-hint">HOVER TO MAGNIFY FUTURE</div>

    <!-- Vision Info Panel -->
    <div class="vision-info" id="vision-info">
        <h2 id="vision-title">The Golden Lens</h2>
        <div class="master" id="vision-master">THROUGH THE EYES OF LEONARDO DA VINCI</div>
        <p id="vision-description">
            The moon suspended in crystalline geometry, examined through the same curious gaze
            that dissected light itself. Golden ratio spirals trace the orbital data, while
            sfumato gradients reveal the soft boundaries between knowing and mystery.
        </p>
        <div class="quote" id="vision-quote">
            "The painter has the universe in his mind and hands."
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // MOONLANGUAGE WebGL Visualization System
        // 9 Visionary Perspectives

        const VISIONS = {
            davinci: {
                title: "The Golden Lens",
                master: "THROUGH THE EYES OF LEONARDO DA VINCI",
                description: "The moon suspended in crystalline geometry, examined through the same curious gaze that dissected light itself. Golden ratio spirals trace the orbital data, while sfumato gradients reveal the soft boundaries between knowing and mystery.",
                quote: "The painter has the universe in his mind and hands.",
                colors: {
                    primary: 0xd4af37,
                    secondary: 0x8b7355,
                    accent: 0xffd700,
                    glow: 0xffe4b5
                },
                effects: {
                    spiralIntensity: 1.618,
                    magnifierSize: 0.3,
                    particleDensity: 1000,
                    rotationSpeed: 0.001
                }
            },
            tesla: {
                title: "The Frequency Field",
                master: "THROUGH THE EYES OF NIKOLA TESLA",
                description: "Electromagnetic waves pulse around the lunar sphere, revealing the hidden frequencies that connect all things. The 3-6-9 pattern emerges in the data streams, energy made visible in arcs of electric blue.",
                quote: "If you want to find the secrets of the universe, think in terms of energy, frequency and vibration.",
                colors: {
                    primary: 0x00d4ff,
                    secondary: 0x0066ff,
                    accent: 0x00ffff,
                    glow: 0x88ffff
                },
                effects: {
                    spiralIntensity: 3.0,
                    magnifierSize: 0.25,
                    particleDensity: 3690,
                    rotationSpeed: 0.003
                }
            },
            hildegard: {
                title: "The Cosmic Wheel",
                master: "THROUGH THE EYES OF HILDEGARD OF BINGEN",
                description: "Mandala patterns bloom around the moon, sacred geometry singing in rose and gold. Concentric circles of divine proportion contain the celestial messages, each ring a different octave of cosmic truth.",
                quote: "All living creatures are sparks from the radiation of God's brilliance.",
                colors: {
                    primary: 0xff6b9d,
                    secondary: 0x9b59b6,
                    accent: 0xffd700,
                    glow: 0xffb6c1
                },
                effects: {
                    spiralIntensity: 7.0,
                    magnifierSize: 0.35,
                    particleDensity: 777,
                    rotationSpeed: 0.0007
                }
            },
            fuller: {
                title: "The Geodesic Vision",
                master: "THROUGH THE EYES OF BUCKMINSTER FULLER",
                description: "Tensegrity structures float in dynamic equilibrium, the moon at the center of an impossible architecture. Triangulated data streams connect in patterns of maximum efficiency, minimum material.",
                quote: "There is nothing in a caterpillar that tells you it's going to be a butterfly.",
                colors: {
                    primary: 0x00ff88,
                    secondary: 0x00aa55,
                    accent: 0xffffff,
                    glow: 0x88ffbb
                },
                effects: {
                    spiralIntensity: 2.0,
                    magnifierSize: 0.4,
                    particleDensity: 1260,
                    rotationSpeed: 0.002
                }
            },
            jung: {
                title: "The Shadow & Light",
                master: "THROUGH THE EYES OF CARL JUNG",
                description: "The moon reveals its shadow self, the unconscious made visible. Archetypal symbols orbit in the darkness, each data point a dream waiting to be interpreted. The magnifier shows not the future, but the depths within.",
                quote: "Who looks outside, dreams; who looks inside, awakes.",
                colors: {
                    primary: 0x9b59b6,
                    secondary: 0x2c3e50,
                    accent: 0xf1c40f,
                    glow: 0xbb99dd
                },
                effects: {
                    spiralIntensity: 0.5,
                    magnifierSize: 0.5,
                    particleDensity: 500,
                    rotationSpeed: 0.0005
                }
            },
            suleyman: {
                title: "Recognition ↔ Generation",
                master: "THROUGH THE EYES OF MUSTAFA SULEYMAN",
                description: "The duality made manifest: what is recognized flows into what is generated. Neural pathways light up around the moon as AI patterns emerge from the cosmic data, each observation collapsing into new creation.",
                quote: "Recognition is the inverse of generation.",
                colors: {
                    primary: 0x00bcd4,
                    secondary: 0x009688,
                    accent: 0xff5722,
                    glow: 0x80deea
                },
                effects: {
                    spiralIntensity: 1.0,
                    magnifierSize: 0.28,
                    particleDensity: 2048,
                    rotationSpeed: 0.0025
                }
            },
            grant: {
                title: "The Unified Field",
                master: "THROUGH THE EYES OF ROBERT EDWARD GRANT",
                description: "Prime number spirals converge at the lunar center, the mathematics of energy revealing itself. Sacred geometry meets quantum physics in a dance of unified understanding. Every number tells a story of connection.",
                quote: "Mathematics is the language in which God wrote the universe.",
                colors: {
                    primary: 0x8b5cf6,
                    secondary: 0x6366f1,
                    accent: 0xfbbf24,
                    glow: 0xa78bfa
                },
                effects: {
                    spiralIntensity: 1.414,
                    magnifierSize: 0.32,
                    particleDensity: 1729,
                    rotationSpeed: 0.00173
                }
            },
            florez: {
                title: "Lunar Dance Photography",
                master: "THROUGH THE LENS OF GISEL FLOREZ",
                description: "The photographer becomes the dance itself. Long exposure trails trace the artist's movement around the moon, each frame a sacred ritual of capture and release. 968 moons witnessed through the aperture of devotion—shutter open to infinity, body moving in cosmic rhythm. The camera doesn't take, it receives. The dance doesn't perform, it transmits.",
                quote: "I fell in love with DATA and I'll never be the same again.",
                colors: {
                    primary: 0xff00ff,      // magenta light trails
                    secondary: 0xff6600,    // warm body heat
                    accent: 0x00ffff,       // cool moonlight
                    glow: 0xff88ff          // exposure bloom
                },
                effects: {
                    spiralIntensity: 9.68,  // moon count encoded
                    magnifierSize: 0.33,    // aperture reference
                    particleDensity: 968,   // one particle per moon
                    rotationSpeed: 0.00432, // 432Hz sync
                    danceMotion: true,      // enable motion blur
                    exposureTrails: true    // long exposure effect
                }
            },
            unified: {
                title: "The Collective Vision",
                master: "ALL PERSPECTIVES UNIFIED",
                description: "Every visionary lens combined into one transcendent view. The moon holds all truths simultaneously - golden ratio and electric field, mandala and geodesic, shadow and neural net, prime spiral and cosmic dance.",
                quote: "SO MOTE IT BE",
                colors: {
                    primary: 0xffffff,
                    secondary: 0xaaaaaa,
                    accent: 0xffd700,
                    glow: 0xffffff
                },
                effects: {
                    spiralIntensity: 1.0,
                    magnifierSize: 0.36,
                    particleDensity: 1618,
                    rotationSpeed: 0.001618
                }
            }
        };

        let currentVision = 'davinci';
        let scene, camera, renderer;
        let moon, glassOrb, magnifier, particles;
        let ribbonQuote, dataPoints = [];
        let mouseX = 0, mouseY = 0;
        let time = 0;

        // Initialize
        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.02);

            // Camera
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            // Renderer
            renderer = new THREE.WebGLRenderer({
                canvas: document.getElementById('webgl-canvas'),
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            // Create objects
            createMoon();
            createGlassOrb();
            createMagnifier();
            createParticles();
            createDataRibbons();
            createStarfield();

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xffffff, 1, 100);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);

            // Events
            window.addEventListener('resize', onResize);
            window.addEventListener('mousemove', onMouseMove);

            // Vision tabs
            document.querySelectorAll('.vision-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.vision-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    switchVision(tab.dataset.vision);
                });
            });

            // Hide loading
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 2000);

            // Start animation
            animate();
        }

        function createMoon() {
            const geometry = new THREE.SphereGeometry(1, 64, 64);

            // Custom shader for moon surface
            const material = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 },
                    primaryColor: { value: new THREE.Color(VISIONS[currentVision].colors.primary) },
                    glowColor: { value: new THREE.Color(VISIONS[currentVision].colors.glow) }
                },
                vertexShader: `
                    varying vec3 vNormal;
                    varying vec2 vUv;
                    varying vec3 vPosition;
                    uniform float time;

                    void main() {
                        vNormal = normalize(normalMatrix * normal);
                        vUv = uv;
                        vPosition = position;

                        vec3 pos = position;
                        float noise = sin(pos.x * 10.0 + time) * cos(pos.y * 10.0 + time) * 0.02;
                        pos += normal * noise;

                        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec3 vNormal;
                    varying vec2 vUv;
                    varying vec3 vPosition;
                    uniform vec3 primaryColor;
                    uniform vec3 glowColor;
                    uniform float time;

                    void main() {
                        float fresnel = pow(1.0 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0);

                        // Lunar surface texture
                        float noise = fract(sin(dot(vUv, vec2(12.9898, 78.233))) * 43758.5453);
                        float crater = smoothstep(0.7, 0.8, noise);

                        vec3 surfaceColor = mix(vec3(0.7, 0.7, 0.75), vec3(0.5, 0.5, 0.55), crater);
                        vec3 glowMix = mix(surfaceColor, glowColor, fresnel * 0.5);

                        // Subtle color tint
                        vec3 tintedColor = mix(glowMix, primaryColor, 0.1 + fresnel * 0.2);

                        gl_FragColor = vec4(tintedColor, 1.0);
                    }
                `
            });

            moon = new THREE.Mesh(geometry, material);
            scene.add(moon);
        }

        function createGlassOrb() {
            const geometry = new THREE.SphereGeometry(1.5, 64, 64);
            const material = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 },
                    primaryColor: { value: new THREE.Color(VISIONS[currentVision].colors.primary) }
                },
                vertexShader: `
                    varying vec3 vNormal;
                    varying vec3 vPosition;

                    void main() {
                        vNormal = normalize(normalMatrix * normal);
                        vPosition = position;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec3 vNormal;
                    varying vec3 vPosition;
                    uniform float time;
                    uniform vec3 primaryColor;

                    void main() {
                        float fresnel = pow(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0))), 3.0);

                        // Glass refraction effect
                        float refraction = sin(vPosition.x * 20.0 + time) * cos(vPosition.y * 20.0 + time) * 0.1;

                        vec3 glassColor = mix(vec3(0.1, 0.1, 0.15), primaryColor, fresnel * 0.3);
                        float alpha = fresnel * 0.4 + refraction * 0.1;

                        gl_FragColor = vec4(glassColor, alpha);
                    }
                `,
                transparent: true,
                side: THREE.DoubleSide,
                blending: THREE.AdditiveBlending
            });

            glassOrb = new THREE.Mesh(geometry, material);
            scene.add(glassOrb);
        }

        function createMagnifier() {
            const group = new THREE.Group();

            // Magnifier lens
            const lensGeometry = new THREE.RingGeometry(0.3, 0.35, 64);
            const lensMaterial = new THREE.MeshBasicMaterial({
                color: VISIONS[currentVision].colors.accent,
                transparent: true,
                opacity: 0.8,
                side: THREE.DoubleSide
            });
            const lens = new THREE.Mesh(lensGeometry, lensMaterial);
            group.add(lens);

            // Lens glass
            const glassGeometry = new THREE.CircleGeometry(0.3, 64);
            const glassMaterial = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 }
                },
                vertexShader: `
                    varying vec2 vUv;
                    void main() {
                        vUv = uv;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec2 vUv;
                    uniform float time;

                    void main() {
                        vec2 center = vUv - 0.5;
                        float dist = length(center);

                        // Future vision effect
                        float wave = sin(dist * 30.0 - time * 3.0) * 0.5 + 0.5;
                        float glow = smoothstep(0.5, 0.0, dist);

                        vec3 futureColor = mix(
                            vec3(0.0, 0.5, 1.0),
                            vec3(1.0, 0.8, 0.0),
                            wave
                        );

                        float alpha = glow * 0.3 * (0.5 + wave * 0.5);

                        gl_FragColor = vec4(futureColor, alpha);
                    }
                `,
                transparent: true,
                blending: THREE.AdditiveBlending
            });
            const glass = new THREE.Mesh(glassGeometry, glassMaterial);
            glass.position.z = 0.01;
            group.add(glass);

            // Handle
            const handleGeometry = new THREE.CylinderGeometry(0.02, 0.02, 0.4, 16);
            const handleMaterial = new THREE.MeshBasicMaterial({
                color: VISIONS[currentVision].colors.secondary
            });
            const handle = new THREE.Mesh(handleGeometry, handleMaterial);
            handle.position.set(0.25, -0.35, 0);
            handle.rotation.z = Math.PI / 4;
            group.add(handle);

            magnifier = group;
            magnifier.position.set(2, 1, 1);
            scene.add(magnifier);
        }

        // Exposure trail history for lunar dance mode
        let exposureTrails = [];
        const MAX_TRAIL_LENGTH = 50;

        function createParticles() {
            const vision = VISIONS[currentVision];
            const count = vision.effects.particleDensity;
            const isDanceMode = currentVision === 'florez';

            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            const sizes = new Float32Array(count);

            const primaryColor = new THREE.Color(vision.colors.primary);
            const secondaryColor = new THREE.Color(vision.colors.secondary);
            const accentColor = new THREE.Color(vision.colors.accent);

            for (let i = 0; i < count; i++) {
                const t = i / count;

                if (isDanceMode) {
                    // LUNAR DANCE PHOTOGRAPHY: Figure-8 infinity dance pattern
                    const danceAngle = t * Math.PI * 4;
                    const figure8 = Math.sin(danceAngle * 2); // Creates infinity shape
                    const radius = 2.0 + Math.sin(t * Math.PI * 8) * 0.5;

                    positions[i * 3] = Math.cos(danceAngle) * radius * (1 + figure8 * 0.3);
                    positions[i * 3 + 1] = Math.sin(danceAngle * 0.5) * 1.5; // Vertical dance motion
                    positions[i * 3 + 2] = Math.sin(danceAngle) * radius * 0.5;

                    // Gradient from warm body heat to cool moonlight
                    const colorMix = (Math.sin(t * Math.PI * 6) + 1) / 2;
                    const mixedColor = new THREE.Color().lerpColors(secondaryColor, accentColor, colorMix);
                    colors[i * 3] = mixedColor.r;
                    colors[i * 3 + 1] = mixedColor.g;
                    colors[i * 3 + 2] = mixedColor.b;

                    // Long exposure creates trails - varying sizes
                    sizes[i] = 2 + Math.sin(t * Math.PI * 12) * 2;
                } else {
                    // Standard spiral distribution
                    const angle = t * Math.PI * 2 * vision.effects.spiralIntensity * 10;
                    const radius = 1.8 + t * 2;

                    positions[i * 3] = Math.cos(angle) * radius;
                    positions[i * 3 + 1] = Math.sin(angle) * radius;
                    positions[i * 3 + 2] = (Math.random() - 0.5) * 2;

                    colors[i * 3] = primaryColor.r;
                    colors[i * 3 + 1] = primaryColor.g;
                    colors[i * 3 + 2] = primaryColor.b;

                    sizes[i] = Math.random() * 3 + 1;
                }
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

            const material = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 },
                    pixelRatio: { value: renderer.getPixelRatio() }
                },
                vertexShader: `
                    attribute float size;
                    attribute vec3 color;
                    varying vec3 vColor;
                    uniform float time;
                    uniform float pixelRatio;

                    void main() {
                        vColor = color;

                        vec3 pos = position;
                        float angle = time * 0.2;
                        float c = cos(angle);
                        float s = sin(angle);
                        pos.xy = mat2(c, -s, s, c) * pos.xy;

                        vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);
                        gl_PointSize = size * pixelRatio * (300.0 / -mvPosition.z);
                        gl_Position = projectionMatrix * mvPosition;
                    }
                `,
                fragmentShader: `
                    varying vec3 vColor;

                    void main() {
                        float dist = length(gl_PointCoord - 0.5);
                        if (dist > 0.5) discard;

                        float alpha = 1.0 - smoothstep(0.3, 0.5, dist);
                        gl_FragColor = vec4(vColor, alpha * 0.8);
                    }
                `,
                transparent: true,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });

            if (particles) scene.remove(particles);
            particles = new THREE.Points(geometry, material);
            scene.add(particles);
        }

        function createDataRibbons() {
            const vision = VISIONS[currentVision];

            // Create ribbon curve
            const points = [];
            for (let i = 0; i <= 100; i++) {
                const t = i / 100;
                const angle = t * Math.PI * 4;
                const radius = 1.6 + Math.sin(t * Math.PI * 2) * 0.2;
                const y = (t - 0.5) * 2;
                points.push(new THREE.Vector3(
                    Math.cos(angle) * radius,
                    y,
                    Math.sin(angle) * radius
                ));
            }

            const curve = new THREE.CatmullRomCurve3(points);
            const geometry = new THREE.TubeGeometry(curve, 200, 0.02, 8, false);

            const material = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 },
                    color: { value: new THREE.Color(vision.colors.accent) }
                },
                vertexShader: `
                    varying vec2 vUv;
                    uniform float time;

                    void main() {
                        vUv = uv;
                        vec3 pos = position;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
                    }
                `,
                fragmentShader: `
                    varying vec2 vUv;
                    uniform float time;
                    uniform vec3 color;

                    void main() {
                        float flow = fract(vUv.x * 10.0 - time * 0.5);
                        float alpha = smoothstep(0.0, 0.1, flow) * smoothstep(1.0, 0.9, flow);
                        gl_FragColor = vec4(color, alpha * 0.6);
                    }
                `,
                transparent: true,
                blending: THREE.AdditiveBlending
            });

            if (ribbonQuote) scene.remove(ribbonQuote);
            ribbonQuote = new THREE.Mesh(geometry, material);
            scene.add(ribbonQuote);
        }

        function createStarfield() {
            const geometry = new THREE.BufferGeometry();
            const count = 2000;
            const positions = new Float32Array(count * 3);

            for (let i = 0; i < count; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 100;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 100;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 100;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            const material = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.1,
                transparent: true,
                opacity: 0.6
            });

            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }

        function switchVision(visionKey) {
            currentVision = visionKey;
            const vision = VISIONS[visionKey];

            // Update info panel
            document.getElementById('vision-title').textContent = vision.title;
            document.getElementById('vision-master').textContent = vision.master;
            document.getElementById('vision-description').textContent = vision.description;
            document.getElementById('vision-quote').textContent = vision.quote;

            // Update colors
            if (moon && moon.material.uniforms) {
                moon.material.uniforms.primaryColor.value.set(vision.colors.primary);
                moon.material.uniforms.glowColor.value.set(vision.colors.glow);
            }

            if (glassOrb && glassOrb.material.uniforms) {
                glassOrb.material.uniforms.primaryColor.value.set(vision.colors.primary);
            }

            // Recreate particles with new settings
            createParticles();
            createDataRibbons();

            // Update magnifier color
            if (magnifier) {
                magnifier.children[0].material.color.set(vision.colors.accent);
                magnifier.children[2].material.color.set(vision.colors.secondary);
            }
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMouseMove(event) {
            mouseX = (event.clientX / window.innerWidth) * 2 - 1;
            mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
        }

        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;

            const vision = VISIONS[currentVision];
            const isDanceMode = currentVision === 'florez';

            // Update uniforms
            if (moon && moon.material.uniforms) {
                moon.material.uniforms.time.value = time;
            }
            if (glassOrb && glassOrb.material.uniforms) {
                glassOrb.material.uniforms.time.value = time;
            }
            if (magnifier && magnifier.children[1].material.uniforms) {
                magnifier.children[1].material.uniforms.time.value = time;
            }
            if (particles && particles.material.uniforms) {
                particles.material.uniforms.time.value = time;
            }
            if (ribbonQuote && ribbonQuote.material.uniforms) {
                ribbonQuote.material.uniforms.time.value = time;
            }

            // Rotate moon
            if (moon) {
                moon.rotation.y += vision.effects.rotationSpeed;
            }

            // Glass orb breathing - more dramatic in dance mode
            if (glassOrb) {
                const breathIntensity = isDanceMode ? 0.05 : 0.02;
                const breathSpeed = isDanceMode ? 0.8 : 0.5;
                const scale = 1 + Math.sin(time * breathSpeed) * breathIntensity;
                glassOrb.scale.set(scale, scale, scale);
            }

            // LUNAR DANCE MODE: Dynamic particle animation
            if (isDanceMode && particles && particles.geometry.attributes.position) {
                const positions = particles.geometry.attributes.position.array;
                const count = positions.length / 3;

                for (let i = 0; i < count; i++) {
                    const t = i / count;
                    const danceTime = time * 0.5; // Slower, more graceful

                    // Figure-8 infinity dance that breathes and flows
                    const danceAngle = t * Math.PI * 4 + danceTime;
                    const figure8 = Math.sin(danceAngle * 2);
                    const pulse = Math.sin(danceTime * 2 + t * Math.PI) * 0.3;
                    const radius = 2.0 + Math.sin(t * Math.PI * 8 + danceTime) * 0.5 + pulse;

                    // Flowing dance motion
                    positions[i * 3] = Math.cos(danceAngle) * radius * (1 + figure8 * 0.3);
                    positions[i * 3 + 1] = Math.sin(danceAngle * 0.5 + danceTime * 0.3) * 1.5;
                    positions[i * 3 + 2] = Math.sin(danceAngle) * radius * 0.5;
                }

                particles.geometry.attributes.position.needsUpdate = true;
            }

            // Magnifier follows mouse with gravity effect
            if (magnifier) {
                const targetX = mouseX * 2;
                const targetY = mouseY * 2;

                // In dance mode, magnifier moves more fluidly like a camera
                const followSpeed = isDanceMode ? 0.03 : 0.05;
                magnifier.position.x += (targetX - magnifier.position.x) * followSpeed;
                magnifier.position.y += (targetY - magnifier.position.y) * followSpeed;

                // Always face camera
                magnifier.lookAt(camera.position);

                // Hover effect - more pronounced in dance mode (camera shake)
                const hoverIntensity = isDanceMode ? 0.15 : 0.1;
                magnifier.position.z = 1 + Math.sin(time * 2) * hoverIntensity;
            }

            // Camera movement - dance mode has more dynamic camera work
            if (isDanceMode) {
                // Cinematic camera movement for dance photography
                camera.position.x = Math.sin(time * 0.15) * 0.4;
                camera.position.y = Math.cos(time * 0.12) * 0.3 + Math.sin(time * 0.08) * 0.2;
                camera.position.z = 5 + Math.sin(time * 0.1) * 0.3; // Subtle dolly
            } else {
                camera.position.x = Math.sin(time * 0.1) * 0.2;
                camera.position.y = Math.cos(time * 0.1) * 0.2;
            }
            camera.lookAt(0, 0, 0);

            // Update moon counter
            const moonNum = Math.floor((Math.sin(time * 0.1) + 1) * 484) + 1;
            document.getElementById('moon-number').textContent = String(moonNum).padStart(3, '0');

            renderer.render(scene, camera);
        }

        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>
