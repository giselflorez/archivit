<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT-R8 | THOUGHT STREAM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* SACRED PALETTE */
        :root {
            --void: #030308;
            --cosmic: #0a0a12;
            --panel: #0e0e18;
            --surface: #141420;
            --border: rgba(255,255,255,0.06);
            --border-hover: rgba(255,255,255,0.12);
            --gold: #d4a574;
            --gold-dim: #b08d57;
            --gold-glow: rgba(212,165,116,0.3);
            --emerald: #54a876;
            --emerald-glow: rgba(84,168,118,0.4);
            --rose: #ba6587;
            --violet: #7865ba;
            --text: #f0ece7;
            --text-dim: #9a9690;
            --text-muted: #5a5854;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--void);
            color: var(--text);
            overflow: hidden;
            height: 100vh;
            font-size: 15px;
        }

        /* HEADER - Matches NFT-8 */
        .header {
            position: fixed;
            top: 0; left: 0; right: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background: var(--cosmic);
            z-index: 100;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gold);
            letter-spacing: 0.05em;
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .header-nav a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.5rem 0.9rem;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .header-nav a:hover {
            color: var(--text-dim);
        }

        .header-nav a.active {
            color: var(--void);
            background: var(--gold);
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            margin-left: 1rem;
        }

        .h-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
        }

        .h-btn:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        .h-btn.primary {
            background: linear-gradient(135deg, var(--emerald), #3d8a5e);
            border-color: transparent;
            color: var(--void);
        }

        .h-btn.primary:hover {
            box-shadow: 0 0 16px var(--emerald-glow);
        }

        /* CANVAS */
        .canvas {
            position: fixed;
            top: 56px; left: 0; right: 0; bottom: 32px;
            overflow: hidden;
            cursor: grab;
        }

        .canvas:active { cursor: grabbing; }

        .canvas-inner {
            position: absolute;
            width: 4000px;
            height: 3000px;
            background-image: radial-gradient(circle at 1px 1px, rgba(212,165,116,0.05) 1px, transparent 0);
            background-size: 50px 50px;
        }

        /* FRAGMENT */
        .fragment {
            position: absolute;
            min-width: 200px;
            max-width: 340px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.1rem;
            cursor: move;
            transition: transform 0.1s, box-shadow 0.3s, border-color 0.3s;
            user-select: none;
        }

        .fragment:hover {
            border-color: var(--gold-glow);
            box-shadow: 0 8px 28px rgba(0,0,0,0.4);
        }

        .fragment.selected {
            border-color: var(--gold);
            box-shadow: 0 0 0 1px var(--gold), 0 8px 28px rgba(212,165,116,0.2);
        }

        .fragment.dragging {
            transform: scale(1.02);
            box-shadow: 0 16px 48px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .fragment-text {
            font-size: 0.95rem;
            line-height: 1.6;
            font-weight: 400;
            margin-bottom: 0.75rem;
            color: var(--text);
        }

        .fragment-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-muted);
        }

        .fragment-time { letter-spacing: 0.08em; }

        .fragment-tags {
            display: flex;
            gap: 0.4rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .tag {
            font-size: 0.65rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            background: rgba(255,255,255,0.04);
            color: var(--text-dim);
        }

        .tag.research { color: var(--emerald); background: rgba(84,168,118,0.12); }
        .tag.quote { color: var(--violet); background: rgba(120,101,186,0.12); }
        .tag.todo { color: var(--gold); background: rgba(212,165,116,0.12); }
        .tag.verified { color: var(--emerald); background: rgba(84,168,118,0.2); font-weight: 700; }

        /* ACTION BAR */
        .action-bar {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--panel);
            border: 1px solid var(--gold-dim);
            border-radius: 10px;
            padding: 0.75rem 1.25rem;
            display: flex;
            gap: 0.6rem;
            align-items: center;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .action-bar.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .action-count {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gold);
            padding-right: 0.75rem;
            border-right: 1px solid var(--border);
            letter-spacing: 0.08em;
        }

        .action-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            padding: 0.5rem 0.9rem;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        .action-btn.research { border-color: var(--emerald-glow); color: var(--emerald); }
        .action-btn.research:hover { background: rgba(84,168,118,0.1); }

        /* ZOOM CONTROLS */
        .zoom {
            position: fixed;
            bottom: 80px;
            right: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            z-index: 50;
        }

        .zoom-btn {
            width: 40px; height: 40px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-dim);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        .zoom-level {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            letter-spacing: 0.08em;
        }

        /* MINIMAP */
        .minimap {
            position: fixed;
            bottom: 52px;
            right: 1.25rem;
            width: 160px;
            height: 100px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            z-index: 50;
        }

        .minimap-viewport {
            position: absolute;
            border: 1px solid var(--gold);
            background: rgba(212,165,116,0.1);
        }

        .minimap-dot {
            position: absolute;
            width: 4px; height: 4px;
            background: var(--text-muted);
            border-radius: 2px;
        }

        .minimap-dot.selected { background: var(--gold); }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(3,3,8,0.95);
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .modal.visible { display: flex; }

        .modal-box {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            max-width: 480px;
            width: 90%;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            color: var(--text);
        }

        .modal-sub {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-dim);
            margin-bottom: 1.5rem;
        }

        .dropzone {
            border: 2px dashed var(--border);
            border-radius: 10px;
            padding: 2.5rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dropzone:hover, .dropzone.over {
            border-color: var(--gold-dim);
            background: rgba(212,165,116,0.03);
        }

        .dropzone-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            opacity: 0.5;
            color: var(--gold);
        }

        .dropzone-text {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-dim);
        }

        .dropzone-hint {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.6rem;
            margin-top: 1.5rem;
        }

        /* FOOTER */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 32px;
            background: var(--void);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-muted);
            z-index: 50;
        }

        .footer a {
            color: var(--text-dim);
            text-decoration: none;
            margin: 0 0.3rem;
        }

        .footer a:hover { color: var(--gold); }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">IT-R8</div>
        <nav class="header-nav">
            <a href="/">Home</a>
            <a href="/doc8">DOC-8</a>
            <a href="/nft8">NFT-8</a>
            <a href="/cre8">CRE-8</a>
            <a href="/soci8" class="active">SOCI-8</a>
            <a href="/archive">Archive</a>
            <div class="header-actions">
                <button class="h-btn" onclick="showModal()">Import</button>
                <button class="h-btn" onclick="autoArrange()">Arrange</button>
                <button class="h-btn primary" onclick="sendToResearch()">Research</button>
            </div>
        </nav>
    </header>

    <div class="canvas" id="canvas">
        <div class="canvas-inner" id="inner"></div>
    </div>

    <div class="action-bar" id="actionBar">
        <span class="action-count"><span id="count">0</span> SELECTED</span>
        <button class="action-btn research" onclick="tagAs('research')">Research</button>
        <button class="action-btn" onclick="tagAs('quote')">Quote</button>
        <button class="action-btn" onclick="tagAs('todo')">Todo</button>
        <button class="action-btn" onclick="connect()">Connect</button>
        <button class="action-btn" onclick="remove()">Remove</button>
    </div>

    <div class="zoom">
        <button class="zoom-btn" onclick="zoomIn()">+</button>
        <div class="zoom-level" id="zoomLvl">100%</div>
        <button class="zoom-btn" onclick="zoomOut()">−</button>
        <button class="zoom-btn" onclick="resetView()">⟲</button>
    </div>

    <div class="minimap" id="minimap">
        <div class="minimap-viewport" id="viewport"></div>
    </div>

    <div class="modal" id="modal">
        <div class="modal-box">
            <h2 class="modal-title">Import Thoughts</h2>
            <p class="modal-sub">Drop a text file or paste content directly</p>
            <div class="dropzone" id="dropzone" onclick="document.getElementById('fileIn').click()">
                <div class="dropzone-icon">◇</div>
                <p class="dropzone-text">Drop file here or click to browse</p>
                <p class="dropzone-hint">Supports .txt exports</p>
            </div>
            <input type="file" id="fileIn" accept=".txt" style="display:none" onchange="handleFile(event)">
            <div class="modal-actions">
                <button class="h-btn" onclick="hideModal()">Cancel</button>
                <button class="h-btn" onclick="loadDemo()">Load Demo</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        ARC-8 | IT-R8 Thought Stream | <a href="/">Home</a> | Your Data. Your Future.
    </footer>

    <script>
        const DEMO = [
            {id:1,text:"Need to find verified Tesla quotes from institutional sources",time:"10:23",x:200,y:150,tags:['research']},
            {id:2,text:'"Be alone, that is the secret of invention; be alone, that is when ideas are born." — Tesla, NYT 1934',time:"10:45",x:500,y:180,tags:['quote','verified']},
            {id:3,text:"The 4D spectral visualization could map cognitive patterns across all masters — time as visible dimension",time:"11:02",x:180,y:380,tags:[]},
            {id:4,text:"Jung BBC Face to Face 1959 — download and transcribe for NORTHSTAR bank",time:"11:15",x:520,y:420,tags:['todo']},
            {id:5,text:"Quote Investigator is the best source for verification — always cross-reference",time:"11:45",x:750,y:250,tags:['research']},
            {id:6,text:"Hildegard of Bingen — find primary sources for music theory quotes. Pre-AI era crucial.",time:"12:01",x:300,y:600,tags:['research','todo']},
            {id:7,text:'"If you want to find the secrets of the universe, think in terms of energy, frequency and vibration." — DISPUTED, no primary source!',time:"12:30",x:700,y:500,tags:['quote']},
        ];

        let fragments = [];
        let selected = new Set();
        let zoom = 1, panX = 0, panY = 0;
        let dragging = null, panning = false, dragOff = {x:0,y:0}, panStart = {x:0,y:0};

        const canvas = document.getElementById('canvas');
        const inner = document.getElementById('inner');

        function render() {
            inner.querySelectorAll('.fragment').forEach(e => e.remove());
            fragments.forEach(f => {
                const el = document.createElement('div');
                el.className = `fragment ${selected.has(f.id)?'selected':''}`;
                el.style.left = f.x + 'px';
                el.style.top = f.y + 'px';
                el.dataset.id = f.id;

                let tags = '';
                if(f.tags.length) {
                    tags = `<div class="fragment-tags">${f.tags.map(t=>`<span class="tag ${t}">${t}</span>`).join('')}</div>`;
                }

                el.innerHTML = `<div class="fragment-text">${f.text}</div><div class="fragment-meta"><span class="fragment-time">${f.time}</span></div>${tags}`;
                el.onmousedown = e => startDrag(e, f);
                el.onclick = e => handleClick(e, f);
                inner.appendChild(el);
            });
            updateMinimap();
        }

        function startDrag(e, f) {
            e.stopPropagation();
            dragging = f;
            dragOff = {x: e.clientX - (f.x * zoom + panX), y: e.clientY - (f.y * zoom + panY + 52)};
            document.querySelector(`.fragment[data-id="${f.id}"]`)?.classList.add('dragging');
        }

        function handleClick(e, f) {
            e.stopPropagation();
            if(e.shiftKey) {
                selected.has(f.id) ? selected.delete(f.id) : selected.add(f.id);
            } else {
                selected.clear();
                selected.add(f.id);
            }
            updateSelection();
        }

        function updateSelection() {
            document.querySelectorAll('.fragment').forEach(el => {
                el.classList.toggle('selected', selected.has(parseInt(el.dataset.id)));
            });
            document.getElementById('count').textContent = selected.size;
            document.getElementById('actionBar').classList.toggle('visible', selected.size > 0);
            updateMinimap();
        }

        canvas.onmousedown = e => {
            if(e.target === canvas || e.target === inner) {
                panning = true;
                panStart = {x: e.clientX - panX, y: e.clientY - panY};
                canvas.style.cursor = 'grabbing';
            }
        };

        document.onmousemove = e => {
            if(panning) {
                panX = e.clientX - panStart.x;
                panY = e.clientY - panStart.y;
                updateTransform();
                updateMinimap();
            }
            if(dragging) {
                dragging.x = (e.clientX - dragOff.x - panX) / zoom;
                dragging.y = (e.clientY - dragOff.y - panY - 52) / zoom;
                const el = document.querySelector(`.fragment[data-id="${dragging.id}"]`);
                if(el) { el.style.left = dragging.x + 'px'; el.style.top = dragging.y + 'px'; }
                updateMinimap();
            }
        };

        document.onmouseup = () => {
            if(dragging) document.querySelector(`.fragment[data-id="${dragging.id}"]`)?.classList.remove('dragging');
            dragging = null;
            panning = false;
            canvas.style.cursor = 'grab';
        };

        canvas.onclick = e => {
            if(e.target === canvas || e.target === inner) {
                selected.clear();
                updateSelection();
            }
        };

        canvas.onwheel = e => {
            e.preventDefault();
            zoom = Math.max(0.3, Math.min(2, zoom * (e.deltaY > 0 ? 0.9 : 1.1)));
            updateTransform();
            updateMinimap();
            document.getElementById('zoomLvl').textContent = Math.round(zoom * 100) + '%';
        };

        function updateTransform() {
            inner.style.transform = `translate(${panX}px, ${panY}px) scale(${zoom})`;
            inner.style.transformOrigin = '0 0';
        }

        function zoomIn() { zoom = Math.min(2, zoom * 1.2); updateTransform(); updateMinimap(); document.getElementById('zoomLvl').textContent = Math.round(zoom*100)+'%'; }
        function zoomOut() { zoom = Math.max(0.3, zoom * 0.8); updateTransform(); updateMinimap(); document.getElementById('zoomLvl').textContent = Math.round(zoom*100)+'%'; }
        function resetView() { zoom = 1; panX = 0; panY = 0; updateTransform(); updateMinimap(); document.getElementById('zoomLvl').textContent = '100%'; }

        function updateMinimap() {
            const map = document.getElementById('minimap');
            const vp = document.getElementById('viewport');
            map.querySelectorAll('.minimap-dot').forEach(d => d.remove());
            const s = 160/4000;
            fragments.forEach(f => {
                const dot = document.createElement('div');
                dot.className = `minimap-dot ${selected.has(f.id)?'selected':''}`;
                dot.style.left = (f.x * s) + 'px';
                dot.style.top = (f.y * s * (100/3000)) + 'px';
                map.appendChild(dot);
            });
            const vw = (window.innerWidth / zoom) * s;
            const vh = ((window.innerHeight - 84) / zoom) * s * (100/3000);
            vp.style.width = vw + 'px';
            vp.style.height = vh + 'px';
            vp.style.left = (-panX / zoom * s) + 'px';
            vp.style.top = (-panY / zoom * s * (100/3000)) + 'px';
        }

        function tagAs(tag) {
            selected.forEach(id => {
                const f = fragments.find(x => x.id === id);
                if(f && !f.tags.includes(tag)) f.tags.push(tag);
            });
            render();
        }

        function connect() { /* TODO: visual connections */ }

        function remove() {
            fragments = fragments.filter(f => !selected.has(f.id));
            selected.clear();
            render();
            updateSelection();
        }

        function autoArrange() {
            const cols = 4, sp = {x: 360, y: 220}, off = {x: 100, y: 100};
            fragments.forEach((f, i) => {
                f.x = off.x + (i % cols) * sp.x;
                f.y = off.y + Math.floor(i / cols) * sp.y;
            });
            render();
        }

        function sendToResearch() {
            const items = fragments.filter(f => selected.size > 0 ? selected.has(f.id) && f.tags.includes('research') : f.tags.includes('research'));
            if(!items.length) { alert('Tag fragments with RESEARCH first'); return; }
            localStorage.setItem('doc8_queries', JSON.stringify(items));
            window.location.href = '/doc8';
        }

        function showModal() { document.getElementById('modal').classList.add('visible'); }
        function hideModal() { document.getElementById('modal').classList.remove('visible'); }

        function loadDemo() {
            hideModal();
            fragments = DEMO.map(d => ({...d}));
            render();
        }

        function handleFile(e) {
            const file = e.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = ev => {
                const lines = ev.target.result.split('\n').filter(l => l.trim());
                fragments = lines.map((l, i) => ({
                    id: i + 1,
                    text: l.trim(),
                    time: '',
                    x: 100 + (i % 4) * 360,
                    y: 100 + Math.floor(i / 4) * 220,
                    tags: []
                }));
                hideModal();
                render();
            };
            reader.readAsText(file);
        }

        const dz = document.getElementById('dropzone');
        dz.ondragover = e => { e.preventDefault(); dz.classList.add('over'); };
        dz.ondragleave = () => dz.classList.remove('over');
        dz.ondrop = e => {
            e.preventDefault();
            dz.classList.remove('over');
            if(e.dataTransfer.files[0]) {
                document.getElementById('fileIn').files = e.dataTransfer.files;
                handleFile({target: {files: e.dataTransfer.files}});
            }
        };

        document.onkeydown = e => {
            if(e.key === 'Escape') { selected.clear(); updateSelection(); }
            if(e.key === 'Delete' || e.key === 'Backspace') { if(selected.size) remove(); }
            if(e.key === 'a' && (e.metaKey || e.ctrlKey)) { e.preventDefault(); fragments.forEach(f => selected.add(f.id)); updateSelection(); }
        };

        loadDemo();
    </script>
</body>
</html>
