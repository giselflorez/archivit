<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOC-8 | ARCHIV-IT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* SACRED PALETTE + DESIGN SYSTEM */
        :root {
            /* Colors */
            --void: #030308;
            --cosmic: #0a0a12;
            --panel: #0e0e18;
            --surface: #141420;
            --card-bg: #12121a;
            --border: rgba(255,255,255,0.06);
            --border-hover: rgba(255,255,255,0.12);
            --gold: #d4a574;
            --gold-dim: #b08d57;
            --gold-muted: rgba(212,165,116,0.15);
            --emerald: #54a876;
            --violet: #7865ba;
            --rose: #ba6587;
            --text: #f0ece7;
            --text-dim: #9a9690;
            --text-muted: #5a5854;

            /* Typography Scale (1.125 ratio) */
            --fs-xs: 0.6875rem;    /* 11px - minimum */
            --fs-sm: 0.75rem;      /* 12px */
            --fs-base: 0.875rem;   /* 14px */
            --fs-md: 1rem;         /* 16px */
            --fs-lg: 1.125rem;     /* 18px */
            --fs-xl: 1.25rem;      /* 20px */

            /* Line Heights */
            --lh-tight: 1.2;
            --lh-snug: 1.35;
            --lh-normal: 1.5;
            --lh-relaxed: 1.65;

            /* Letter Spacing */
            --ls-tight: 0.02em;
            --ls-normal: 0.04em;
            --ls-wide: 0.08em;
            --ls-wider: 0.12em;

            /* Spacing Scale (4px base) */
            --space-1: 0.25rem;    /* 4px */
            --space-2: 0.5rem;     /* 8px */
            --space-3: 0.75rem;    /* 12px */
            --space-4: 1rem;       /* 16px */
            --space-6: 1.5rem;     /* 24px */
            --space-8: 2rem;       /* 32px */
            --space-10: 2.5rem;    /* 40px */
            --space-12: 3rem;      /* 48px */
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--void);
            color: var(--text);
            min-height: 100vh;
            font-size: 15px;
            line-height: 1.5;
        }

        /* HEADER - Matches NFT-8 */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background: var(--cosmic);
        }

        .logo {
            font-size: var(--fs-xl);
            font-weight: 600;
            color: var(--gold);
            letter-spacing: 0.06em;
        }

        .header-nav {
            display: flex;
            gap: var(--space-2);
        }

        .header-nav a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: var(--fs-sm);
            font-weight: 500;
            padding: var(--space-2) var(--space-3);
            border-radius: 6px;
            transition: all 0.15s;
        }

        .header-nav a:hover {
            color: var(--text-dim);
        }

        .header-nav a.active {
            color: var(--void);
            background: var(--gold);
        }

        /* MAIN */
        .main {
            padding: 1.5rem;
        }

        /* VIDEO VIEWER */
        .video-viewer {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .video-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4) var(--space-6);
            border-bottom: 1px solid var(--border);
            background: var(--panel);
        }

        .video-viewer-title {
            font-size: var(--fs-base);
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            letter-spacing: var(--ls-normal);
        }

        .video-viewer-title svg {
            width: 18px;
            height: 18px;
            stroke: var(--gold);
        }

        .badge {
            font-size: var(--fs-xs);
            font-weight: 600;
            letter-spacing: var(--ls-wide);
            text-transform: uppercase;
            padding: var(--space-1) var(--space-2);
            border-radius: 4px;
            background: rgba(84,168,118,0.12);
            color: var(--emerald);
            border: 1px solid rgba(84,168,118,0.2);
            opacity: 0.85;
        }

        .video-content {
            display: grid;
            grid-template-columns: 1.3fr 1fr;
            min-height: 450px;
        }

        @media (max-width: 900px) {
            .video-content { grid-template-columns: 1fr; }
        }

        /* VIDEO PLAYER AREA */
        .video-player-area {
            position: relative;
            background: var(--void);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .video-placeholder {
            text-align: center;
            padding: var(--space-12);
        }

        .play-button {
            width: 90px;
            height: 90px;
            border: 2.5px solid var(--gold-dim);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-6);
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0.85;
            background: rgba(212,165,116,0.05);
        }

        .play-button:hover {
            border-color: var(--gold);
            opacity: 1;
            transform: scale(1.05);
            background: rgba(212,165,116,0.1);
        }

        .play-button svg {
            width: 36px;
            height: 36px;
            stroke: var(--gold);
            margin-left: 4px;
        }

        .video-placeholder-text {
            font-size: var(--fs-md);
            font-weight: 400;
            color: var(--text-dim);
            margin-bottom: var(--space-2);
            cursor: pointer;
            transition: color 0.15s;
        }

        .video-placeholder-text:hover {
            color: var(--gold);
        }

        .video-placeholder-sub {
            font-size: var(--fs-sm);
            color: var(--text-muted);
        }

        /* VIDEO CONTROLS */
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .controls-play {
            width: 36px;
            height: 36px;
            border: none;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .controls-play svg {
            width: 20px;
            height: 20px;
            fill: var(--text-dim);
        }

        .video-timeline {
            flex: 1;
            height: 4px;
            background: var(--panel);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .video-timeline-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 33%;
            background: var(--gold);
            border-radius: 2px;
        }

        .video-time {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-muted);
            font-variant-numeric: tabular-nums;
        }

        /* TRANSCRIPT PANEL */
        .transcript-panel {
            border-left: 1px solid var(--border);
            background: var(--cosmic);
            display: flex;
            flex-direction: column;
        }

        .transcript-header {
            padding: var(--space-4) var(--space-6);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .transcript-title {
            font-size: var(--fs-sm);
            font-weight: 600;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: var(--ls-wider);
        }

        .transcript-badge {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--fs-xs);
            font-weight: 600;
            padding: var(--space-1) var(--space-2);
            border-radius: 3px;
            background: rgba(84,168,118,0.12);
            color: var(--emerald);
        }

        .transcript-badge.processing::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--gold);
            animation: pulseBadge 1.5s ease-in-out infinite;
        }

        @keyframes pulseBadge {
            0%, 100% { opacity: 0.4; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1); }
        }

        .transcript-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-2) 0;
        }

        /* Custom scrollbar */
        .transcript-content::-webkit-scrollbar {
            width: 6px;
        }

        .transcript-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .transcript-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.08);
            border-radius: 3px;
        }

        .transcript-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.15);
        }

        .transcript-line {
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-6);
            cursor: pointer;
            transition: background 0.15s;
        }

        .transcript-line:hover {
            background: rgba(255,255,255,0.02);
        }

        .transcript-line.active {
            background: rgba(212,165,116,0.08);
        }

        .transcript-line.active .transcript-timestamp {
            color: var(--gold);
        }

        .transcript-line.active .transcript-text {
            color: var(--text);
        }

        .line-delete {
            width: 16px;
            height: 16px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 0.75rem;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.15s, color 0.15s;
            padding: 0;
            line-height: 1;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .transcript-line:hover .line-delete {
            opacity: 0.5;
        }

        .line-delete:hover {
            opacity: 1 !important;
            color: var(--rose);
        }

        .transcript-timestamp {
            font-size: var(--fs-sm);
            font-weight: 500;
            color: var(--text-muted);
            font-variant-numeric: tabular-nums;
            white-space: nowrap;
            min-width: 32px;
            margin-top: 2px;
            letter-spacing: 0.01em;
        }

        .transcript-text {
            font-size: var(--fs-base);
            color: var(--text-dim);
            line-height: var(--lh-relaxed);
            flex: 1;
        }

        .transcript-footer {
            padding: var(--space-4) var(--space-6);
            border-top: 1px solid var(--border);
            display: flex;
            gap: var(--space-2);
        }

        .transcript-footer .btn {
            padding: var(--space-2) var(--space-3);
            font-size: var(--fs-xs);
            flex: 1;
        }

        .transcript-footer .btn:last-child {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--void);
        }

        .transcript-footer .btn:last-child:hover {
            background: var(--gold-dim);
        }

        .btn {
            padding: var(--space-2) var(--space-4);
            font-size: var(--fs-sm);
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            letter-spacing: var(--ls-wide);
            text-transform: uppercase;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: transparent;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.15s;
        }

        .btn:hover {
            background: rgba(255,255,255,0.04);
            border-color: var(--border-hover);
            color: var(--text);
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--void);
            flex: 1;
        }

        .btn-primary:hover {
            background: var(--gold-dim);
            border-color: var(--gold-dim);
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            background: transparent;
            border-color: var(--border);
            color: var(--text-dim);
        }

        /* Empty State */
        .transcript-empty {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .empty-state {
            text-align: center;
            color: var(--text-muted);
        }

        .empty-state svg {
            width: 40px;
            height: 40px;
            stroke: var(--text-muted);
            opacity: 0.4;
            margin-bottom: 0.75rem;
        }

        .empty-state span {
            display: block;
            font-size: 0.8rem;
            opacity: 0.6;
        }

        /* INPUT SECTION */
        .input-section {
            margin-bottom: var(--space-8);
            padding-bottom: var(--space-6);
            border-bottom: 1px solid var(--border);
        }

        .query-input {
            width: 100%;
            padding: var(--space-4) var(--space-6);
            font-size: var(--fs-md);
            font-family: 'Inter', sans-serif;
            border: 1px solid rgba(212,165,116,0.2);
            border-radius: 10px;
            background: var(--cosmic);
            color: var(--text);
            margin-bottom: var(--space-6);
            transition: all 0.2s;
            letter-spacing: 0.01em;
        }

        .query-input::placeholder {
            color: var(--text-muted);
        }

        .query-input:focus {
            outline: none;
            border-color: var(--gold-dim);
            box-shadow: 0 0 0 3px rgba(212,165,116,0.1);
        }

        .input-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-3);
        }

        @media (max-width: 700px) {
            .input-options { grid-template-columns: repeat(2, 1fr); }
        }

        .input-option {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-4);
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .input-option:hover {
            border-color: var(--gold-dim);
            background: rgba(212,165,116,0.03);
        }

        .input-option:active {
            transform: scale(0.98);
        }

        .input-option:last-child {
            border-color: var(--gold-dim);
            background: rgba(212,165,116,0.06);
        }

        .input-option svg {
            width: 20px;
            height: 20px;
            stroke: var(--gold);
            flex-shrink: 0;
        }

        .input-option span {
            font-size: var(--fs-base);
            font-weight: 400;
            color: var(--text-dim);
        }

        /* SOURCE RECORD PANEL */
        .source-record {
            margin-top: var(--space-6);
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            display: none;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .source-record.active {
            display: block;
        }

        .source-record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background: var(--panel);
        }

        .source-record-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .source-record-title svg {
            width: 20px;
            height: 20px;
            stroke: var(--gold);
        }

        .source-record-title span {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text);
            letter-spacing: 0.02em;
        }

        .source-type-badge {
            font-size: 0.6rem;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
        }

        .source-type-badge.video {
            background: rgba(120,101,186,0.15);
            color: var(--violet);
            border: 1px solid rgba(120,101,186,0.25);
        }

        .source-type-badge.audio {
            background: rgba(84,168,118,0.15);
            color: var(--emerald);
            border: 1px solid rgba(84,168,118,0.25);
        }

        .source-type-badge.web {
            background: rgba(212,165,116,0.15);
            color: var(--gold);
            border: 1px solid rgba(212,165,116,0.25);
        }

        .source-type-badge.document {
            background: rgba(91,155,213,0.15);
            color: #5b9bd5;
            border: 1px solid rgba(91,155,213,0.25);
        }

        .source-record-content {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1px;
            background: var(--border);
        }

        @media (max-width: 900px) {
            .source-record-content { grid-template-columns: 1fr; }
        }

        .source-section {
            padding: var(--space-6);
            background: var(--card-bg);
        }

        .source-section-label {
            font-size: var(--fs-xs);
            font-weight: 600;
            color: var(--gold-dim);
            text-transform: uppercase;
            letter-spacing: var(--ls-wider);
            margin-bottom: var(--space-3);
        }

        .source-section-value {
            font-size: var(--fs-base);
            font-weight: 500;
            color: var(--text);
            line-height: var(--lh-normal);
        }

        .source-section-value.dim {
            color: var(--text-dim);
            font-size: var(--fs-base);
            font-weight: 400;
        }

        .source-link {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            color: var(--gold);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.15s;
        }

        .source-link:hover {
            color: var(--text);
        }

        .source-link svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
        }

        .source-meta-row {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .source-meta-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .source-meta-item svg {
            width: 14px;
            height: 14px;
            stroke: var(--text-muted);
        }

        .source-meta-item span {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .verification-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .verification-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--emerald);
            box-shadow: 0 0 8px rgba(84,168,118,0.5);
        }

        .verification-dot.pending {
            background: var(--gold);
            box-shadow: 0 0 8px rgba(212,165,116,0.5);
        }

        .verification-text {
            font-size: 0.85rem;
            color: var(--emerald);
            font-weight: 500;
        }

        .verification-text.pending {
            color: var(--gold);
        }

        .source-record-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border-top: 1px solid var(--border);
            background: var(--panel);
        }

        .source-timestamp {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .source-actions {
            display: flex;
            gap: 0.5rem;
        }

        .source-action-btn {
            padding: 0.4rem 0.75rem;
            font-size: 0.65rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            border: 1px solid var(--border);
            border-radius: 5px;
            background: transparent;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.15s;
        }

        .source-action-btn:hover {
            background: rgba(255,255,255,0.04);
            border-color: var(--gold-dim);
            color: var(--text);
        }

        .source-action-btn.primary {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--void);
        }

        .source-action-btn.primary:hover {
            background: var(--gold-dim);
        }

        /* MULTI-SELECT STYLES */
        .transcript-line.selected {
            background: rgba(212,165,116,0.06);
            border-left: 2px solid var(--gold);
            padding-left: calc(1rem - 2px);
        }

        .transcript-line.selected .transcript-timestamp {
            color: var(--gold);
        }

        /* EXTRACTION ENHANCEMENTS */
        .segment-speaker {
            font-size: var(--fs-xs);
            font-weight: 600;
            color: var(--emerald);
            text-transform: uppercase;
            letter-spacing: var(--ls-wide);
            margin-bottom: var(--space-1);
        }

        .segment-type {
            display: inline-block;
            font-size: 0.625rem;
            font-weight: 600;
            padding: 0.2rem 0.45rem;
            border-radius: 3px;
            margin-right: var(--space-1);
            text-transform: uppercase;
            letter-spacing: var(--ls-normal);
        }

        .segment-type.claim { background: rgba(212,165,116,0.2); color: var(--gold); }
        .segment-type.question { background: rgba(91,155,213,0.2); color: #5b9bd5; }
        .segment-type.assertion { background: rgba(120,101,186,0.2); color: var(--violet); }
        .segment-type.fact { background: rgba(84,168,118,0.2); color: var(--emerald); }

        .segment-entities {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-1);
            margin-top: var(--space-2);
        }

        .entity-tag {
            font-size: 0.625rem;
            font-weight: 500;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            background: rgba(255,255,255,0.04);
            color: var(--text-muted);
            border: 1px solid var(--border);
            letter-spacing: 0.01em;
        }

        .segment-confidence {
            font-size: var(--fs-xs);
            color: var(--text-muted);
            margin-top: var(--space-2);
            letter-spacing: 0.01em;
        }

        .segment-confidence .conf-value {
            color: var(--emerald);
            font-weight: 600;
        }

        .segment-confidence .conf-value.medium {
            color: var(--gold);
        }

        .segment-confidence .conf-value.low {
            color: var(--rose);
        }

        .selection-count {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--gold);
            background: rgba(212,165,116,0.15);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        /* MULTI-SOURCE LIST */
        .multi-source-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .multi-source-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 1rem;
            align-items: center;
            padding: 0.9rem 1.5rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.15s;
        }

        .multi-source-item:last-child {
            border-bottom: none;
        }

        .multi-source-item:hover {
            background: rgba(255,255,255,0.02);
        }

        .multi-source-type {
            font-size: 0.55rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            min-width: 50px;
            text-align: center;
        }

        .multi-source-type.video { background: rgba(120,101,186,0.15); color: var(--violet); }
        .multi-source-type.audio { background: rgba(84,168,118,0.15); color: var(--emerald); }
        .multi-source-type.web { background: rgba(212,165,116,0.15); color: var(--gold); }
        .multi-source-type.document { background: rgba(91,155,213,0.15); color: #5b9bd5; }

        .multi-source-info {
            min-width: 0;
        }

        .multi-source-title {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .multi-source-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.15rem;
        }

        .multi-source-segment {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-dim);
            font-variant-numeric: tabular-nums;
            white-space: nowrap;
        }

        .multi-source-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--emerald);
            box-shadow: 0 0 6px rgba(84,168,118,0.4);
        }

        .multi-source-status.pending {
            background: var(--gold);
            box-shadow: 0 0 6px rgba(212,165,116,0.4);
        }

        .multi-source-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .multi-source-header-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text);
        }

        .multi-source-header-count {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* EXPAND TOGGLE */
        .expand-toggle {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.7rem;
            font-size: 0.65rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            border: 1px solid var(--border);
            border-radius: 5px;
            background: transparent;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.15s;
            margin-left: auto;
        }

        .expand-toggle:hover {
            background: rgba(255,255,255,0.04);
            border-color: var(--gold-dim);
            color: var(--text);
        }

        .expand-toggle.active {
            background: rgba(212,165,116,0.15);
            border-color: var(--gold);
            color: var(--gold);
        }

        .expand-toggle svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
            transition: transform 0.2s;
        }

        .expand-toggle.active svg {
            transform: rotate(180deg);
        }

        /* EXPANDED SOURCE RECORD */
        .source-record.expanded {
            max-height: none;
        }

        .source-record.expanded .extracted-text-section {
            display: block;
        }

        /* EXTRACTED TEXT SECTION */
        .extracted-text-section {
            display: none;
            border-top: 1px solid var(--border);
            background: var(--panel);
        }

        .extracted-text-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .extracted-text-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .extracted-text-stats {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .extracted-text-content {
            max-height: 500px;
            overflow-y: auto;
            padding: 0;
        }

        .source-record.expanded .extracted-text-content {
            max-height: none;
        }

        .quote-block {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.15s;
        }

        .quote-block:last-child {
            border-bottom: none;
        }

        .quote-block:hover {
            background: rgba(255,255,255,0.02);
        }

        .quote-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .quote-speaker {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--emerald);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .quote-type {
            font-size: 0.55rem;
            font-weight: 700;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .quote-type.claim { background: rgba(212,165,116,0.2); color: var(--gold); }
        .quote-type.question { background: rgba(91,155,213,0.2); color: #5b9bd5; }
        .quote-type.assertion { background: rgba(120,101,186,0.2); color: var(--violet); }
        .quote-type.fact { background: rgba(84,168,118,0.2); color: var(--emerald); }

        .quote-timestamp {
            font-size: 0.65rem;
            color: var(--text-muted);
            font-variant-numeric: tabular-nums;
            margin-left: auto;
        }

        .quote-text {
            font-size: var(--fs-md);
            font-weight: 300;
            color: var(--text);
            line-height: var(--lh-relaxed);
            font-style: normal;
            padding-left: var(--space-4);
            border-left: 3px solid var(--gold);
            margin-bottom: var(--space-3);
        }

        .quote-entities {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
        }

        .quote-entity {
            font-size: 0.6rem;
            font-weight: 500;
            padding: 0.2rem 0.45rem;
            border-radius: 3px;
            background: rgba(255,255,255,0.04);
            color: var(--text-muted);
            border: 1px solid var(--border);
        }

        .quote-source-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
        }

        .quote-source-badge {
            font-size: 0.5rem;
            font-weight: 700;
            padding: 0.15rem 0.35rem;
            border-radius: 2px;
            text-transform: uppercase;
        }

        .quote-source-badge.video { background: rgba(120,101,186,0.15); color: var(--violet); }
        .quote-source-badge.audio { background: rgba(84,168,118,0.15); color: var(--emerald); }
        .quote-source-badge.web { background: rgba(212,165,116,0.15); color: var(--gold); }
        .quote-source-badge.document { background: rgba(91,155,213,0.15); color: #5b9bd5; }

        .quote-source-title {
            font-size: 0.7rem;
            color: var(--text-dim);
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .quote-confidence {
            font-size: 0.6rem;
            color: var(--text-muted);
        }

        .quote-confidence .conf-high { color: var(--emerald); }
        .quote-confidence .conf-medium { color: var(--gold); }
        .quote-confidence .conf-low { color: var(--rose); }

        /* KEYBOARD SHORTCUTS HINT */
        .shortcuts-hint {
            display: flex;
            gap: var(--space-6);
            padding: var(--space-2) var(--space-6);
            background: rgba(255,255,255,0.02);
            border-top: 1px solid var(--border);
            font-size: var(--fs-xs);
            color: var(--text-muted);
        }

        .shortcuts-hint kbd {
            display: inline-block;
            padding: 0.15rem 0.4rem;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 3px;
            font-family: inherit;
            font-size: 0.6rem;
            margin: 0 0.2rem;
        }

        /* FOOTER */
        .footer {
            text-align: center;
            padding: var(--space-6);
            border-top: 1px solid rgba(255,255,255,0.03);
            margin-top: var(--space-8);
            font-size: var(--fs-sm);
            font-weight: 400;
            color: var(--text-muted);
            opacity: 0.7;
        }

        .footer a {
            color: var(--text-dim);
            text-decoration: none;
        }

        .footer a:hover { color: var(--gold); }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">DOC-8</div>
        <nav class="header-nav">
            <a href="/">Home</a>
            <a href="/doc8" class="active">DOC-8</a>
            <a href="/nft8">NFT-8</a>
            <a href="/cre8">CRE-8</a>
            <a href="/itr8">IT-R8</a>
            <a href="/archive">Archive</a>
        </nav>
    </header>

    <main class="main">
        <!-- Input Section -->
        <div class="input-section">
            <input type="text" class="query-input" placeholder="Enter research query... (e.g., 'Verified Tesla quotes')">

            <div class="input-options">
                <div class="input-option">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                    <span>Paste URL</span>
                </div>
                <div class="input-option">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <span>Upload File</span>
                </div>
                <div class="input-option">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                    <span>Paste Text</span>
                </div>
                <div class="input-option">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="23 7 16 12 23 17 23 7"></polygon>
                        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
                    </svg>
                    <span>Video Import</span>
                </div>
            </div>
        </div>

        <!-- Archival Video Viewer -->
        <div class="video-viewer">
            <div class="video-viewer-header">
                <div class="video-viewer-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>
                        <line x1="7" y1="2" x2="7" y2="22"></line>
                        <line x1="17" y1="2" x2="17" y2="22"></line>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <line x1="2" y1="7" x2="7" y2="7"></line>
                        <line x1="2" y1="17" x2="7" y2="17"></line>
                        <line x1="17" y1="17" x2="22" y2="17"></line>
                        <line x1="17" y1="7" x2="22" y2="7"></line>
                    </svg>
                    Archival Video Viewer
                </div>
                <span class="badge">PRE-AI VERIFIED</span>
            </div>

            <div class="video-content">
                <!-- Video Player Area -->
                <div class="video-player-area">
                    <div class="video-placeholder">
                        <div class="play-button">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                        </div>
                        <div class="video-placeholder-text">Drop video or select from archive</div>
                        <div class="video-placeholder-sub">Supports MP4, MOV, WebM | Transcripts auto-generated</div>
                    </div>

                    <div class="video-controls">
                        <button class="controls-play" disabled>
                            <svg viewBox="0 0 24 24">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                        </button>
                        <div class="video-timeline">
                            <div class="video-timeline-progress" style="width: 0;"></div>
                        </div>
                        <span class="video-time">--:-- / --:--</span>
                    </div>
                </div>

                <!-- Transcript Panel -->
                <div class="transcript-panel">
                    <div class="transcript-header">
                        <span class="transcript-title">Source Extraction</span>
                        <span class="transcript-badge" id="extraction-status">Processing</span>
                    </div>

                    <div class="transcript-content">
                        <div class="transcript-line" data-speaker="jung" data-type="assertion">
                            <button class="line-delete" title="Remove">×</button>
                            <span class="transcript-timestamp">0:00</span>
                            <div class="transcript-text">
                                <div class="segment-speaker">Carl Jung</div>
                                <span class="segment-type assertion">Assertion</span>
                                "The meeting with oneself is, at first, the meeting with one's own shadow..."
                                <div class="segment-entities">
                                    <span class="entity-tag">Shadow</span>
                                    <span class="entity-tag">Self</span>
                                    <span class="entity-tag">Archetype</span>
                                </div>
                                <div class="segment-confidence">Conf: <span class="conf-value">98%</span> · 3 refs</div>
                            </div>
                        </div>
                        <div class="transcript-line" data-speaker="freeman" data-type="question">
                            <button class="line-delete" title="Remove">×</button>
                            <span class="transcript-timestamp">0:15</span>
                            <div class="transcript-text">
                                <div class="segment-speaker">John Freeman (Interviewer)</div>
                                <span class="segment-type question">Question</span>
                                "Do you believe that was a genuine supernatural experience?"
                                <div class="segment-entities">
                                    <span class="entity-tag">Belief</span>
                                    <span class="entity-tag">Supernatural</span>
                                </div>
                                <div class="segment-confidence">Conf: <span class="conf-value">95%</span></div>
                            </div>
                        </div>
                        <div class="transcript-line" data-speaker="jung" data-type="claim">
                            <button class="line-delete" title="Remove">×</button>
                            <span class="transcript-timestamp">0:32</span>
                            <div class="transcript-text">
                                <div class="segment-speaker">Carl Jung</div>
                                <span class="segment-type claim">Claim</span>
                                "I don't need to believe, I know."
                                <div class="segment-entities">
                                    <span class="entity-tag">Epistemology</span>
                                    <span class="entity-tag">Gnosis</span>
                                </div>
                                <div class="segment-confidence">Conf: <span class="conf-value">99%</span> · 12 citations</div>
                            </div>
                        </div>
                        <div class="transcript-line" data-speaker="coltrane" data-type="assertion">
                            <button class="line-delete" title="Remove">×</button>
                            <span class="transcript-timestamp">0:58</span>
                            <div class="transcript-text">
                                <div class="segment-speaker">John Coltrane</div>
                                <span class="segment-type assertion">Assertion</span>
                                "I want to be a force for real good. I want to make people happy..."
                                <div class="segment-entities">
                                    <span class="entity-tag">Purpose</span>
                                    <span class="entity-tag">Music</span>
                                </div>
                                <div class="segment-confidence">Conf: <span class="conf-value">94%</span> · 5 refs</div>
                            </div>
                        </div>
                        <div class="transcript-line" data-speaker="tesla" data-type="fact">
                            <button class="line-delete" title="Remove">×</button>
                            <span class="transcript-timestamp">1:24</span>
                            <div class="transcript-text">
                                <div class="segment-speaker">Nikola Tesla</div>
                                <span class="segment-type fact">Fact</span>
                                "The day science begins to study non-physical phenomena..."
                                <div class="segment-entities">
                                    <span class="entity-tag">Science</span>
                                    <span class="entity-tag">Energy</span>
                                    <span class="entity-tag">Progress</span>
                                </div>
                                <div class="segment-confidence">Conf: <span class="conf-value medium">78%</span> · Verification needed</div>
                            </div>
                        </div>
                        <div class="transcript-line" data-speaker="davinci" data-type="assertion">
                            <button class="line-delete" title="Remove">×</button>
                            <span class="transcript-timestamp">1:51</span>
                            <div class="transcript-text">
                                <div class="segment-speaker">Leonardo da Vinci</div>
                                <span class="segment-type assertion">Assertion</span>
                                "I have been impressed with the urgency of doing..."
                                <div class="segment-entities">
                                    <span class="entity-tag">Action</span>
                                    <span class="entity-tag">Time</span>
                                </div>
                                <div class="segment-confidence">Conf: <span class="conf-value">96%</span> · Codex verified</div>
                            </div>
                        </div>
                        <div class="transcript-line" data-speaker="fuller" data-type="claim">
                            <button class="line-delete" title="Remove">×</button>
                            <span class="transcript-timestamp">2:18</span>
                            <div class="transcript-text">
                                <div class="segment-speaker">Buckminster Fuller</div>
                                <span class="segment-type claim">Claim</span>
                                "You never change things by fighting the existing reality..."
                                <div class="segment-entities">
                                    <span class="entity-tag">Systems</span>
                                    <span class="entity-tag">Change</span>
                                    <span class="entity-tag">Design</span>
                                </div>
                                <div class="segment-confidence">Conf: <span class="conf-value">97%</span> · 8 refs</div>
                            </div>
                        </div>
                    </div>

                    <div class="shortcuts-hint">
                        <span><kbd>Click</kbd> Select</span>
                        <span><kbd>Shift</kbd>+<kbd>Click</kbd> Range</span>
                        <span><kbd>⌘</kbd>+<kbd>Click</kbd> Multi</span>
                        <span><kbd>Esc</kbd> Clear</span>
                    </div>

                    <div class="transcript-footer">
                        <button class="btn">Export</button>
                        <button class="btn">Text</button>
                        <button class="btn">Add to Bank</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Source Record Panel - Shows when transcript line is selected -->
        <div class="source-record" id="source-record">
            <div class="source-record-header">
                <div class="source-record-title">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                    <span>Source Record</span>
                    <span class="selection-count" id="selection-count" style="display:none;">3 selected</span>
                </div>
                <button class="expand-toggle" id="expand-toggle" title="Expand to show full context">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                    <span>Expand</span>
                </button>
                <span class="source-type-badge video" id="source-type-badge">VIDEO</span>
            </div>

            <!-- Single Source View -->
            <div id="single-source-view">
                <div class="source-record-content">
                    <div class="source-section">
                        <div class="source-section-label">Original Source</div>
                        <div class="source-section-value" id="source-title">Carl Jung - Face to Face Interview (BBC, 1959)</div>
                        <a href="#" class="source-link" id="source-link" target="_blank">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                <polyline points="15 3 21 3 21 9"></polyline>
                                <line x1="10" y1="14" x2="21" y2="3"></line>
                            </svg>
                            View Original
                        </a>
                    </div>

                    <div class="source-section">
                        <div class="source-section-label">Metadata</div>
                        <div class="source-meta-row">
                            <div class="source-meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <polyline points="12 6 12 12 16 14"></polyline>
                                </svg>
                                <span id="source-duration">38:24</span>
                            </div>
                            <div class="source-meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                                <span id="source-date">Oct 22, 1959</span>
                            </div>
                            <div class="source-meta-item">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <span id="source-author">BBC Television</span>
                            </div>
                        </div>
                    </div>

                    <div class="source-section">
                        <div class="source-section-label">Verification</div>
                        <div class="verification-status">
                            <div class="verification-dot" id="verification-dot"></div>
                            <span class="verification-text" id="verification-text">Pre-AI Verified</span>
                        </div>
                        <div class="source-section-value dim" id="verification-detail">Archived 1959 · Added to bank Jan 12, 2026</div>
                    </div>
                </div>
            </div>

            <!-- Multi-Source View (Shift-Select) -->
            <div id="multi-source-view" style="display:none;">
                <div class="multi-source-header">
                    <span class="multi-source-header-title">Selected Sources</span>
                    <span class="multi-source-header-count" id="multi-source-count">3 sources from 2 origins</span>
                </div>
                <div class="multi-source-list" id="multi-source-list">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Extracted Text Section (Expandable) -->
            <div class="extracted-text-section" id="extracted-text-section">
                <div class="extracted-text-header">
                    <span class="extracted-text-title">Extracted Text</span>
                    <span class="extracted-text-stats" id="extracted-text-stats">7 quotes · 342 words</span>
                </div>
                <div class="extracted-text-content" id="extracted-text-content">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <div class="source-record-footer">
                <span class="source-timestamp" id="source-segment">Segment: 0:32 - 0:58</span>
                <div class="source-actions">
                    <button class="source-action-btn" id="btn-copy">Copy Citation</button>
                    <button class="source-action-btn" id="btn-view">View Full</button>
                    <button class="source-action-btn primary" id="btn-add">Add Segment</button>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        ARC-8 | DOC-8 Archivist | <a href="/">Home</a> | Your Data. Your Future.
    </footer>

    <script>
        // Demo source data - in production this comes from the database
        const sourceData = {
            '0:00': {
                type: 'video',
                title: 'Carl Jung - Face to Face Interview (BBC, 1959)',
                url: 'https://archive.org/details/jung-bbc-1959',
                duration: '38:24',
                date: 'Oct 22, 1959',
                author: 'BBC Television',
                verified: true,
                verifiedDate: 'Jan 12, 2026',
                segment: '0:00 - 0:15'
            },
            '0:15': {
                type: 'video',
                title: 'Carl Jung - Face to Face Interview (BBC, 1959)',
                url: 'https://archive.org/details/jung-bbc-1959',
                duration: '38:24',
                date: 'Oct 22, 1959',
                author: 'BBC Television',
                verified: true,
                verifiedDate: 'Jan 12, 2026',
                segment: '0:15 - 0:32'
            },
            '0:32': {
                type: 'video',
                title: 'Carl Jung - Face to Face Interview (BBC, 1959)',
                url: 'https://archive.org/details/jung-bbc-1959',
                duration: '38:24',
                date: 'Oct 22, 1959',
                author: 'BBC Television',
                verified: true,
                verifiedDate: 'Jan 12, 2026',
                segment: '0:32 - 0:58'
            },
            '0:58': {
                type: 'audio',
                title: 'John Coltrane Interview (WKCR Radio, 1958)',
                url: 'https://archive.org/details/coltrane-wkcr-1958',
                duration: '22:15',
                date: 'Nov 8, 1958',
                author: 'WKCR Radio',
                verified: true,
                verifiedDate: 'Jan 10, 2026',
                segment: '0:58 - 1:24'
            },
            '1:24': {
                type: 'web',
                title: 'Tesla\'s "Problem of Increasing Human Energy" (Century Magazine)',
                url: 'https://teslauniverse.com/nikola-tesla/articles/problem-increasing-human-energy',
                duration: '—',
                date: 'June 1900',
                author: 'Nikola Tesla',
                verified: true,
                verifiedDate: 'Jan 8, 2026',
                segment: '1:24 - 1:51'
            },
            '1:51': {
                type: 'document',
                title: 'Codex Atlanticus, f. 119v (Leonardo da Vinci)',
                url: 'https://www.codex-atlanticus.it/',
                duration: '—',
                date: 'c. 1478-1519',
                author: 'Leonardo da Vinci',
                verified: true,
                verifiedDate: 'Jan 5, 2026',
                segment: '1:51 - 2:18'
            },
            '2:18': {
                type: 'video',
                title: 'Buckminster Fuller - Everything I Know (Session 1)',
                url: 'https://archive.org/details/EverythingIKnow',
                duration: '4:32:00',
                date: 'Jan 1975',
                author: 'BFI',
                verified: true,
                verifiedDate: 'Jan 11, 2026',
                segment: '2:18 - end'
            }
        };

        // Selection state
        let lastClickedIndex = -1;
        let selectedLines = new Set();
        const allLines = Array.from(document.querySelectorAll('.transcript-line'));

        // Get line index
        function getLineIndex(line) {
            return allLines.indexOf(line);
        }

        // Update the source record panel based on selection
        function updateSourcePanel() {
            const panel = document.getElementById('source-record');
            const singleView = document.getElementById('single-source-view');
            const multiView = document.getElementById('multi-source-view');
            const selectionCount = document.getElementById('selection-count');
            const badge = document.getElementById('source-type-badge');

            if (selectedLines.size === 0) {
                panel.classList.remove('active');
                return;
            }

            panel.classList.add('active');

            if (selectedLines.size === 1) {
                // Single selection - show detailed view
                singleView.style.display = 'block';
                multiView.style.display = 'none';
                selectionCount.style.display = 'none';
                badge.style.display = 'inline-block';

                const line = Array.from(selectedLines)[0];
                const timestamp = line.querySelector('.transcript-timestamp').textContent;
                const data = sourceData[timestamp];

                if (data) {
                    badge.className = 'source-type-badge ' + data.type;
                    badge.textContent = data.type.toUpperCase();

                    document.getElementById('source-title').textContent = data.title;
                    document.getElementById('source-link').href = data.url;
                    document.getElementById('source-duration').textContent = data.duration;
                    document.getElementById('source-date').textContent = data.date;
                    document.getElementById('source-author').textContent = data.author;
                    document.getElementById('source-segment').textContent = 'Segment: ' + data.segment;

                    const dot = document.getElementById('verification-dot');
                    const text = document.getElementById('verification-text');
                    const detail = document.getElementById('verification-detail');

                    if (data.verified) {
                        dot.classList.remove('pending');
                        text.classList.remove('pending');
                        text.textContent = 'Pre-AI Verified';
                        detail.textContent = 'Original: ' + data.date + ' · Added to bank ' + data.verifiedDate;
                    } else {
                        dot.classList.add('pending');
                        text.classList.add('pending');
                        text.textContent = 'Pending Verification';
                        detail.textContent = 'Awaiting user approval';
                    }
                }

                document.getElementById('btn-add').textContent = 'Add Segment';
            } else {
                // Multi-selection - show list view
                singleView.style.display = 'none';
                multiView.style.display = 'block';
                selectionCount.style.display = 'inline-block';
                selectionCount.textContent = selectedLines.size + ' selected';
                badge.style.display = 'none';

                // Build multi-source list
                const listContainer = document.getElementById('multi-source-list');
                listContainer.innerHTML = '';

                // Count unique sources
                const uniqueSources = new Set();
                const sortedLines = Array.from(selectedLines).sort((a, b) => getLineIndex(a) - getLineIndex(b));

                sortedLines.forEach(line => {
                    const timestamp = line.querySelector('.transcript-timestamp').textContent;
                    const data = sourceData[timestamp];
                    if (data) {
                        uniqueSources.add(data.title);

                        const item = document.createElement('div');
                        item.className = 'multi-source-item';
                        item.innerHTML = `
                            <span class="multi-source-type ${data.type}">${data.type.toUpperCase()}</span>
                            <div class="multi-source-info">
                                <div class="multi-source-title">${data.title}</div>
                                <div class="multi-source-meta">${data.author} · ${data.date}</div>
                            </div>
                            <span class="multi-source-segment">${data.segment}</span>
                            <div class="multi-source-status ${data.verified ? '' : 'pending'}"></div>
                        `;
                        listContainer.appendChild(item);
                    }
                });

                document.getElementById('multi-source-count').textContent =
                    selectedLines.size + ' segments from ' + uniqueSources.size + ' source' + (uniqueSources.size !== 1 ? 's' : '');
                document.getElementById('source-segment').textContent = selectedLines.size + ' segments selected';
                document.getElementById('btn-add').textContent = 'Add All Segments';
            }
        }

        // Handle transcript line clicks with shift-select
        allLines.forEach((line, index) => {
            line.addEventListener('click', function(e) {
                if (e.shiftKey && lastClickedIndex !== -1) {
                    // Shift+Click: Select range
                    const start = Math.min(lastClickedIndex, index);
                    const end = Math.max(lastClickedIndex, index);

                    for (let i = start; i <= end; i++) {
                        allLines[i].classList.add('selected');
                        selectedLines.add(allLines[i]);
                    }
                } else if (e.ctrlKey || e.metaKey) {
                    // Ctrl/Cmd+Click: Toggle individual selection
                    if (selectedLines.has(this)) {
                        this.classList.remove('selected');
                        this.classList.remove('active');
                        selectedLines.delete(this);
                    } else {
                        this.classList.add('selected');
                        selectedLines.add(this);
                    }
                    lastClickedIndex = index;
                } else {
                    // Normal click: Single selection
                    allLines.forEach(l => {
                        l.classList.remove('selected');
                        l.classList.remove('active');
                    });
                    selectedLines.clear();

                    this.classList.add('active');
                    this.classList.add('selected');
                    selectedLines.add(this);
                    lastClickedIndex = index;
                }

                updateSourcePanel();
            });
        });

        // Delete button handlers
        document.querySelectorAll('.line-delete').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                const line = this.closest('.transcript-line');
                selectedLines.delete(line);
                line.remove();
                updateSourcePanel();
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape: Clear selection
            if (e.key === 'Escape') {
                allLines.forEach(l => {
                    l.classList.remove('selected');
                    l.classList.remove('active');
                });
                selectedLines.clear();
                lastClickedIndex = -1;
                updateSourcePanel();
            }

            // Ctrl/Cmd+A: Select all
            if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                const transcriptContent = document.querySelector('.transcript-content');
                if (transcriptContent.matches(':hover')) {
                    e.preventDefault();
                    allLines.forEach(l => {
                        l.classList.add('selected');
                        selectedLines.add(l);
                    });
                    updateSourcePanel();
                }
            }
        });

        // Expand toggle functionality
        const expandToggle = document.getElementById('expand-toggle');
        const sourceRecord = document.getElementById('source-record');

        expandToggle.addEventListener('click', function() {
            this.classList.toggle('active');
            sourceRecord.classList.toggle('expanded');

            const label = this.querySelector('span');
            if (this.classList.contains('active')) {
                label.textContent = 'Collapse';
                updateExtractedText();
            } else {
                label.textContent = 'Expand';
            }
        });

        // Update extracted text section
        function updateExtractedText() {
            const container = document.getElementById('extracted-text-content');
            const stats = document.getElementById('extracted-text-stats');
            container.innerHTML = '';

            if (selectedLines.size === 0) {
                container.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-muted);">No segments selected</div>';
                stats.textContent = '0 quotes';
                return;
            }

            const sortedLines = Array.from(selectedLines).sort((a, b) => getLineIndex(a) - getLineIndex(b));
            let totalWords = 0;

            sortedLines.forEach(line => {
                const timestamp = line.querySelector('.transcript-timestamp').textContent;
                const speaker = line.querySelector('.segment-speaker')?.textContent || 'Unknown';
                const typeEl = line.querySelector('.segment-type');
                const type = typeEl ? typeEl.classList[1] : 'assertion';
                const typeName = typeEl ? typeEl.textContent : 'Assertion';

                // Get the actual quote text (remove speaker, type badge, entities, confidence)
                const textDiv = line.querySelector('.transcript-text');
                let quoteText = '';
                textDiv.childNodes.forEach(node => {
                    if (node.nodeType === Node.TEXT_NODE) {
                        quoteText += node.textContent;
                    }
                });
                quoteText = quoteText.trim().replace(/^[""]|[""]$/g, '');

                // Get entities
                const entityEls = line.querySelectorAll('.entity-tag');
                const entities = Array.from(entityEls).map(el => el.textContent);

                // Get confidence
                const confEl = line.querySelector('.conf-value');
                const confidence = confEl ? confEl.textContent : '—';
                const confClass = confEl ? (
                    confEl.classList.contains('medium') ? 'conf-medium' :
                    confEl.classList.contains('low') ? 'conf-low' : 'conf-high'
                ) : 'conf-high';

                // Get source data
                const data = sourceData[timestamp] || {};

                // Count words
                totalWords += quoteText.split(/\s+/).length;

                const block = document.createElement('div');
                block.className = 'quote-block';
                block.innerHTML = `
                    <div class="quote-header">
                        <span class="quote-speaker">${speaker}</span>
                        <span class="quote-type ${type}">${typeName}</span>
                        <span class="quote-timestamp">${timestamp}</span>
                    </div>
                    <div class="quote-text">${quoteText}</div>
                    ${entities.length > 0 ? `
                        <div class="quote-entities">
                            ${entities.map(e => `<span class="quote-entity">${e}</span>`).join('')}
                        </div>
                    ` : ''}
                    <div class="quote-source-info">
                        <span class="quote-source-badge ${data.type || 'video'}">${(data.type || 'video').toUpperCase()}</span>
                        <span class="quote-source-title">${data.title || 'Unknown Source'}</span>
                        <span class="quote-confidence">Conf: <span class="${confClass}">${confidence}</span></span>
                    </div>
                `;
                container.appendChild(block);
            });

            stats.textContent = `${sortedLines.length} quote${sortedLines.length !== 1 ? 's' : ''} · ${totalWords} words`;
        }

        // Also update extracted text when selection changes (if expanded)
        const originalUpdateSourcePanel = updateSourcePanel;
        updateSourcePanel = function() {
            originalUpdateSourcePanel();
            if (sourceRecord.classList.contains('expanded')) {
                updateExtractedText();
            }
        };
    </script>
</body>
</html>
