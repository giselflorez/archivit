<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT-8 | COLLECTOR</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --void: #030308;
            --cosmic: #0a0a12;
            --panel: #0e0e18;
            --surface: #141420;
            --border: rgba(255,255,255,0.08);
            --gold: #d4a574;
            --gold-dim: #b08d57;
            --emerald: #54a876;
            --orange: #e8a855;
            --blue: #5b9bd5;
            --text: #f0ece7;
            --text-dim: #9a9690;
            --text-muted: #5a5854;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--void);
            color: var(--text);
            min-height: 100vh;
            font-size: 14px;
        }

        /* HEADER */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            background: var(--cosmic);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gold);
            letter-spacing: 0.05em;
        }

        .header-nav {
            display: flex;
            gap: 0.25rem;
        }

        .header-nav a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.5rem 0.9rem;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .header-nav a:hover {
            color: var(--text-dim);
        }

        .header-nav a.active {
            color: var(--void);
            background: var(--gold);
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 0;
            padding: 0 1.5rem;
            background: var(--cosmic);
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 0.9rem 1.25rem;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-muted);
            background: transparent;
            border: none;
            cursor: pointer;
            transition: all 0.15s;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
        }

        .tab:hover { color: var(--text-dim); }
        .tab.active {
            color: var(--text);
            border-bottom-color: var(--gold);
        }

        /* MAIN */
        .main {
            padding: 1.5rem;
        }

        /* GRID */
        .grid {
            display: grid;
            grid-template-columns: 160px 320px 1fr;
            gap: 1.25rem;
            align-items: start;
        }

        @media (max-width: 1100px) { .grid { grid-template-columns: 160px 1fr; } }
        @media (max-width: 700px) { .grid { grid-template-columns: 1fr; } }

        /* WALLET SCANNER */
        .wallet-scanner {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
        }

        .scanner-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.75rem;
        }

        .scanner-input {
            width: 100%;
            padding: 0.6rem 0.75rem;
            font-size: 0.8rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .scanner-input::placeholder { color: var(--text-muted); }
        .scanner-input:focus { outline: none; border-color: var(--gold-dim); }

        .scan-btn {
            width: 100%;
            padding: 0.6rem;
            font-size: 0.75rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--gold-dim), var(--gold));
            border: none;
            border-radius: 6px;
            color: var(--void);
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .chain-list { margin-bottom: 1rem; }

        .chain-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0;
            border-bottom: 1px solid var(--border);
        }

        .chain-row:last-child { border-bottom: none; }

        .chain-badge {
            font-size: 0.6rem;
            font-weight: 700;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            min-width: 32px;
            text-align: center;
        }

        .chain-badge.eth { background: rgba(98,126,234,0.2); color: #627eea; }
        .chain-badge.poly { background: rgba(130,71,229,0.2); color: #8247e5; }
        .chain-badge.xtz { background: rgba(44,125,247,0.2); color: #2c7df7; }

        .chain-name { flex: 1; font-size: 0.8rem; color: var(--text-dim); }
        .chain-count { font-size: 0.85rem; font-weight: 600; color: var(--text); }

        .scanner-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.4rem;
        }

        .scanner-stat {
            background: var(--surface);
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
        }

        .scanner-stat-num {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text);
        }

        .scanner-stat-lbl {
            font-size: 0.6rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* PROFILE CARD */
        .profile-card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.25rem;
        }

        .profile-top {
            display: flex;
            align-items: center;
            gap: 0.9rem;
            margin-bottom: 1rem;
        }

        .avatar {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a4a2a, #54a876);
            border: 3px solid var(--emerald);
            box-shadow: 0 0 16px rgba(84,168,118,0.35);
            flex-shrink: 0;
        }

        .profile-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text);
        }

        .profile-badge {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--emerald);
            letter-spacing: 0.05em;
        }

        .profile-sub {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* BARS */
        .bars { margin-bottom: 0.9rem; }

        .bar-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.4rem;
        }

        .bar-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            width: 70px;
        }

        .bar-track {
            flex: 1;
            height: 6px;
            background: var(--surface);
            border-radius: 3px;
            overflow: hidden;
        }

        .bar-fill { height: 100%; border-radius: 3px; }
        .bar-fill.green { background: linear-gradient(90deg, #2d8a52, var(--emerald)); }
        .bar-fill.blue { background: linear-gradient(90deg, #3b82f6, var(--blue)); }
        .bar-fill.violet { background: linear-gradient(90deg, #6854b0, #7865ba); }
        .bar-fill.orange { background: linear-gradient(90deg, #c07830, var(--orange)); }

        .bar-value {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
            width: 24px;
            text-align: right;
        }

        /* TAGS ROW */
        .tags-row {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding: 0.6rem;
            background: var(--surface);
            border-radius: 6px;
        }

        .tag-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        .tag-item svg { width: 14px; height: 14px; }
        .tag-item.green svg { color: var(--emerald); }
        .tag-item.orange svg { color: var(--orange); }
        .tag-item.blue svg { color: var(--blue); }
        .tag-item strong { color: var(--text); font-weight: 700; }

        /* PROFILE STATS */
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.4rem;
            margin-bottom: 1rem;
        }

        .profile-stat {
            text-align: center;
            padding: 0.6rem;
            background: var(--surface);
            border-radius: 6px;
        }

        .profile-stat-num {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text);
        }

        .profile-stat-lbl {
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .view-btn {
            display: block;
            width: 100%;
            padding: 0.85rem;
            background: linear-gradient(135deg, var(--gold-dim), var(--gold));
            border: none;
            border-radius: 8px;
            color: var(--void);
            font-size: 0.9rem;
            font-weight: 700;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
            margin-bottom: 0.75rem;
        }

        .profile-footer {
            text-align: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            letter-spacing: 0.05em;
        }

        /* COLLECTION */
        .collection {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.25rem;
        }

        .collection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .collection-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
        }

        .collection-tabs {
            display: flex;
            gap: 0.25rem;
        }

        .collection-tab {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-muted);
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .collection-tab:hover { border-color: var(--gold-dim); color: var(--text-dim); }
        .collection-tab.active { background: var(--surface); color: var(--text); }

        /* NFT GRID */
        .nft-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 0.6rem;
            margin-bottom: 1.25rem;
        }

        .nft-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nft-item:hover {
            border-color: var(--gold-dim);
            transform: translateY(-2px);
        }

        .nft-preview {
            aspect-ratio: 1;
            background: linear-gradient(135deg, var(--panel) 0%, var(--cosmic) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            padding: 0.25rem;
            text-align: center;
        }

        .nft-info {
            padding: 0.5rem;
        }

        .nft-name {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nft-meta {
            font-size: 0.6rem;
            color: var(--text-muted);
            margin-top: 0.15rem;
        }

        /* COLLECTION SCORE */
        .collection-score {
            display: flex;
            align-items: center;
            gap: 0.9rem;
            padding: 1rem;
            background: var(--surface);
            border-radius: 8px;
        }

        .score-ring {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: conic-gradient(var(--emerald) 0% 85%, var(--surface) 85% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-shrink: 0;
            box-shadow: 0 0 12px rgba(84,168,118,0.3);
        }

        .score-ring::before {
            content: '';
            position: absolute;
            width: 36px;
            height: 36px;
            background: var(--surface);
            border-radius: 50%;
        }

        .score-num {
            position: relative;
            font-size: 1rem;
            font-weight: 800;
            color: var(--emerald);
        }

        .score-text {
            flex: 1;
        }

        .score-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.2rem;
        }

        .score-desc {
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        /* FOOTER */
        .footer {
            text-align: center;
            padding: 1rem 1.5rem;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-muted);
            border-top: 1px solid var(--border);
            margin-top: 1.5rem;
        }

        .footer a {
            color: var(--text-dim);
            text-decoration: none;
        }

        .footer a:hover { color: var(--gold); }

        /* TAB CONTENT */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .tab-placeholder {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
        }

        .tab-placeholder h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .tab-placeholder p {
            font-size: 0.9rem;
            color: var(--text-dim);
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           SWAP & SEND - Cross-Chain Decentralized Exchange
           THORChain + Chainflip Integration - Truly Sovereign
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        .swap-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            max-width: 900px;
        }

        @media (max-width: 800px) { .swap-container { grid-template-columns: 1fr; } }

        .swap-panel, .send-panel {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .panel-title svg {
            width: 20px;
            height: 20px;
            color: var(--gold);
        }

        .provider-badge {
            font-size: 0.6rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            background: rgba(84,168,118,0.15);
            color: var(--emerald);
            border-radius: 4px;
            letter-spacing: 0.05em;
        }

        /* Token Selector */
        .token-box {
            position: relative;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: border-color 0.2s;
        }

        .token-box:focus-within {
            border-color: var(--gold-dim);
        }

        .token-box-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 0.5rem;
        }

        .token-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .token-select {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            min-width: 130px;
            user-select: none;
        }

        .token-select:hover {
            border-color: var(--gold);
            background: var(--cosmic);
            transform: translateY(-1px);
        }

        .token-select:active {
            transform: translateY(0);
            background: rgba(212,165,116,0.15);
        }

        .token-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 800;
            color: #fff;
        }

        .token-icon.btc { background: linear-gradient(135deg, #f7931a, #e8830c); }
        .token-icon.eth { background: linear-gradient(135deg, #627eea, #4a5dc8); }
        .token-icon.usdt { background: linear-gradient(135deg, #26a17b, #1d8b6a); }
        .token-icon.usdc { background: linear-gradient(135deg, #2775ca, #1d5fa8); }
        .token-icon.xtz { background: linear-gradient(135deg, #2c7df7, #1a5ac7); }
        .token-icon.matic { background: linear-gradient(135deg, #8247e5, #6a35c7); }
        .token-icon.sol { background: linear-gradient(135deg, #9945ff, #14f195); }

        .token-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
        }

        .token-chain {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        .token-dropdown-arrow {
            margin-left: auto;
            color: var(--text-muted);
            transition: transform 0.2s ease;
        }

        .token-dropdown.show ~ .token-row .token-dropdown-arrow,
        .token-box:has(.token-dropdown.show) .token-dropdown-arrow {
            transform: rotate(180deg);
            color: var(--gold);
        }

        .token-input {
            flex: 1;
            background: transparent;
            border: none;
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text);
            text-align: right;
            outline: none;
        }

        .token-input::placeholder { color: var(--text-muted); }

        .token-balance {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .max-btn {
            color: var(--gold);
            cursor: pointer;
            font-weight: 600;
        }

        .max-btn:hover { text-decoration: underline; }

        /* Swap Arrow */
        .swap-arrow {
            display: flex;
            justify-content: center;
            margin: -0.5rem 0;
            position: relative;
            z-index: 2;
        }

        .swap-arrow-btn {
            width: 40px;
            height: 40px;
            background: var(--panel);
            border: 2px solid var(--border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-dim);
        }

        .swap-arrow-btn:hover {
            border-color: var(--gold);
            color: var(--gold);
            transform: rotate(180deg);
        }

        .swap-arrow-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Rate Info */
        .rate-info {
            background: var(--surface);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 1rem;
        }

        .rate-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 0.4rem;
        }

        .rate-row:last-child { margin-bottom: 0; }

        .rate-label { color: var(--text-muted); }
        .rate-value { color: var(--text); font-weight: 500; }
        .rate-value.green { color: var(--emerald); }
        .rate-value.gold { color: var(--gold); }

        /* Swap Button */
        .swap-btn {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--gold-dim), var(--gold));
            border: none;
            border-radius: 10px;
            color: var(--void);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .swap-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(212,165,116,0.3);
        }

        .swap-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .swap-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Send Panel */
        .address-input-wrap {
            position: relative;
            margin-bottom: 1rem;
        }

        .address-input {
            width: 100%;
            padding: 0.9rem 3rem 0.9rem 1rem;
            font-size: 0.85rem;
            font-family: 'JetBrains Mono', monospace;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            outline: none;
            transition: border-color 0.2s;
        }

        .address-input:focus { border-color: var(--gold-dim); }
        .address-input::placeholder { color: var(--text-muted); }

        .qr-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.15s;
        }

        .qr-btn:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        .qr-btn svg { width: 18px; height: 18px; }

        .send-btn {
            width: 100%;
            padding: 1rem;
            font-size: 1rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .send-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(59,130,246,0.3);
        }

        /* Balances Grid */
        .balances-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .balance-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.15s;
        }

        .balance-card:hover {
            border-color: var(--gold-dim);
        }

        .balance-card.selected {
            border-color: var(--gold);
            background: rgba(212,165,116,0.08);
        }

        .balance-top {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.3rem;
        }

        .balance-amount {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text);
        }

        .balance-usd {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* Token Dropdown */
        .token-dropdown {
            position: absolute;
            top: calc(100% + 4px);
            left: 0;
            right: 0;
            background: var(--panel);
            border: 1px solid var(--gold-dim);
            border-radius: 10px;
            padding: 0.5rem;
            z-index: 1000;
            box-shadow: 0 12px 40px rgba(0,0,0,0.6);
            display: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .token-dropdown.show {
            display: block;
            animation: dropdownFade 0.15s ease-out;
        }

        @keyframes dropdownFade {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .token-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            border: 1px solid transparent;
        }

        .token-option:hover {
            background: var(--surface);
            border-color: var(--gold-dim);
            transform: translateX(4px);
        }

        .token-option:active {
            background: rgba(212,165,116,0.2);
        }

        .token-option-info { flex: 1; }
        .token-option-name { font-size: 0.95rem; font-weight: 600; color: var(--text); }
        .token-option-chain { font-size: 0.7rem; color: var(--text-muted); margin-top: 2px; }
        .token-option-balance { font-size: 0.85rem; color: var(--text-dim); text-align: right; font-weight: 500; }

        /* Transaction Status */
        .tx-status {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }

        .tx-status.show { display: block; }

        .tx-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .tx-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .tx-title { font-weight: 600; color: var(--text); }

        .tx-steps {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .tx-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .tx-step.complete { color: var(--emerald); }
        .tx-step.active { color: var(--gold); }

        .tx-step-icon {
            width: 16px;
            height: 16px;
        }

        /* Sovereign Notice */
        .sovereign-notice {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 0.75rem;
            background: rgba(84,168,118,0.08);
            border: 1px solid rgba(84,168,118,0.2);
            border-radius: 6px;
            margin-top: 1rem;
            font-size: 0.7rem;
            color: var(--emerald);
        }

        .sovereign-notice svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           ADDITIONAL FEATURES - History, QR Scanner, Provider Toggle
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        /* Provider Toggle */
        .provider-toggle {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .provider-btn {
            flex: 1;
            padding: 0.6rem;
            font-size: 0.75rem;
            font-weight: 600;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
        }

        .provider-btn:hover { border-color: var(--gold-dim); color: var(--text-dim); }
        .provider-btn.active {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--void);
        }

        .provider-btn .provider-icon {
            width: 16px;
            height: 16px;
        }

        /* Token support badge */
        .token-support {
            font-size: 0.55rem;
            padding: 0.15rem 0.35rem;
            border-radius: 3px;
            margin-left: auto;
        }
        .token-support.supported { background: rgba(84,168,118,0.2); color: var(--emerald); }
        .token-support.unsupported { background: rgba(186,101,135,0.2); color: var(--rose); }

        /* Transaction History */
        .tx-history {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .tx-history-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .tx-history-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text);
        }

        .tx-history-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .tx-history-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem;
            background: var(--surface);
            border-radius: 6px;
            margin-bottom: 0.4rem;
        }

        .tx-history-item:last-child { margin-bottom: 0; }

        .tx-history-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .tx-history-icon.swap { background: rgba(212,165,116,0.2); color: var(--gold); }
        .tx-history-icon.send { background: rgba(59,130,246,0.2); color: #3b82f6; }
        .tx-history-icon.receive { background: rgba(84,168,118,0.2); color: var(--emerald); }

        .tx-history-info { flex: 1; }
        .tx-history-type { font-size: 0.8rem; font-weight: 600; color: var(--text); }
        .tx-history-detail { font-size: 0.7rem; color: var(--text-muted); }
        .tx-history-amount { text-align: right; }
        .tx-history-value { font-size: 0.85rem; font-weight: 600; color: var(--text); }
        .tx-history-time { font-size: 0.65rem; color: var(--text-muted); }

        .tx-history-empty {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* QR Scanner Modal */
        .qr-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .qr-modal-header {
            color: var(--text);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .qr-video-container {
            width: 100%;
            max-width: 400px;
            aspect-ratio: 1;
            background: var(--panel);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .qr-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .qr-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 2px solid var(--gold);
            border-radius: 12px;
        }

        .qr-modal-close {
            margin-top: 1rem;
            padding: 0.75rem 2rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 0.9rem;
            cursor: pointer;
        }

        .qr-modal-close:hover { border-color: var(--gold); }

        /* Wallet selector */
        .wallet-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .wallet-option {
            padding: 0.75rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s;
            text-align: center;
        }

        .wallet-option:hover { border-color: var(--gold-dim); }
        .wallet-option.connected {
            border-color: var(--emerald);
            background: rgba(84,168,118,0.1);
        }

        .wallet-option-icon {
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }

        .wallet-option-name {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text);
        }

        .wallet-option-status {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        /* Loading spinner for buttons */
        .btn-loading {
            position: relative;
            pointer-events: none;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">NFT-8</div>
        <nav class="header-nav">
            <a href="/">Home</a>
            <a href="/doc8">DOC-8</a>
            <a href="/nft8" class="active">NFT-8</a>
            <a href="/cre8">CRE-8</a>
            <a href="/soci8">SOCI-8</a>
            <a href="/archive">Archive</a>
        </nav>
    </header>

    <div class="tabs">
        <button class="tab active" data-tab="portfolio">Portfolio</button>
        <button class="tab" data-tab="swap">Swap & Send</button>
        <button class="tab" data-tab="provenance">Provenance</button>
        <button class="tab" data-tab="living">Living Works</button>
        <button class="tab" data-tab="network">Network</button>
    </div>

    <main class="main">
        <div class="tab-content active" id="portfolio">
            <div class="grid">
                <!-- WALLET SCANNER -->
                <div class="wallet-scanner">
                    <div class="scanner-title">Wallet Scanner</div>
                    <input type="text" class="scanner-input" placeholder="0x... or tz1...">
                    <button class="scan-btn">Scan Wallet</button>

                    <div class="chain-list">
                        <div class="chain-row">
                            <span class="chain-badge eth">ETH</span>
                            <span class="chain-name">Ethereum</span>
                            <span class="chain-count">47</span>
                        </div>
                        <div class="chain-row">
                            <span class="chain-badge poly">POLY</span>
                            <span class="chain-name">Polygon</span>
                            <span class="chain-count">12</span>
                        </div>
                        <div class="chain-row">
                            <span class="chain-badge xtz">XTZ</span>
                            <span class="chain-name">Tezos</span>
                            <span class="chain-count">23</span>
                        </div>
                    </div>

                    <div class="scanner-stats">
                        <div class="scanner-stat">
                            <div class="scanner-stat-num">82</div>
                            <div class="scanner-stat-lbl">Total</div>
                        </div>
                        <div class="scanner-stat">
                            <div class="scanner-stat-num">14</div>
                            <div class="scanner-stat-lbl">Artists</div>
                        </div>
                        <div class="scanner-stat">
                            <div class="scanner-stat-num">847</div>
                            <div class="scanner-stat-lbl">Days</div>
                        </div>
                        <div class="scanner-stat">
                            <div class="scanner-stat-num">92%</div>
                            <div class="scanner-stat-lbl">Verified</div>
                        </div>
                    </div>
                </div>

                <!-- PROFILE CARD -->
                <div class="profile-card">
                    <div class="profile-top">
                        <div class="avatar"></div>
                        <div>
                            <div class="profile-name">@giselx.art</div>
                            <div class="profile-badge">ESTABLISHED</div>
                            <div class="profile-sub">68.5th percentile</div>
                        </div>
                    </div>

                    <div class="bars">
                        <div class="bar-row">
                            <span class="bar-label">Vitality</span>
                            <div class="bar-track"><div class="bar-fill green" style="width: 72%;"></div></div>
                            <span class="bar-value">72</span>
                        </div>
                        <div class="bar-row">
                            <span class="bar-label">Network</span>
                            <div class="bar-track"><div class="bar-fill blue" style="width: 68%;"></div></div>
                            <span class="bar-value">68</span>
                        </div>
                        <div class="bar-row">
                            <span class="bar-label">Transaction</span>
                            <div class="bar-track"><div class="bar-fill violet" style="width: 81%;"></div></div>
                            <span class="bar-value">81</span>
                        </div>
                        <div class="bar-row">
                            <span class="bar-label">Timeline</span>
                            <div class="bar-track"><div class="bar-fill orange" style="width: 65%;"></div></div>
                            <span class="bar-value">65</span>
                        </div>
                    </div>

                    <div class="tags-row">
                        <div class="tag-item green">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            Verified <strong>3</strong>
                        </div>
                        <div class="tag-item orange">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            Review <strong>2</strong>
                        </div>
                        <div class="tag-item blue">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                            Data <strong>18</strong>
                        </div>
                    </div>

                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-num">47</div>
                            <div class="profile-stat-lbl">NFTs</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-num">26</div>
                            <div class="profile-stat-lbl">Collectors</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-num">142</div>
                            <div class="profile-stat-lbl">Transfers</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-num">12.8</div>
                            <div class="profile-stat-lbl">ETH Vol</div>
                        </div>
                    </div>

                    <button class="view-btn">View Your Archive</button>
                    <div class="profile-footer">ARCHIV-IT by WEB3GISEL</div>
                </div>

                <!-- COLLECTION -->
                <div class="collection">
                    <div class="collection-header">
                        <div class="collection-title">Collection</div>
                        <div class="collection-tabs">
                            <button class="collection-tab active">Artist</button>
                            <button class="collection-tab">Chain</button>
                            <button class="collection-tab">Date</button>
                        </div>
                    </div>

                    <div class="nft-grid">
                        <div class="nft-item">
                            <div class="nft-preview">Moon #001</div>
                            <div class="nft-info">
                                <div class="nft-name">MOONLAN...</div>
                                <div class="nft-meta">giselx | ETH</div>
                            </div>
                        </div>
                        <div class="nft-item">
                            <div class="nft-preview">Moon #002</div>
                            <div class="nft-info">
                                <div class="nft-name">MOONLAN...</div>
                                <div class="nft-meta">giselx | ETH</div>
                            </div>
                        </div>
                        <div class="nft-item">
                            <div class="nft-preview">Generative</div>
                            <div class="nft-info">
                                <div class="nft-name">Chromie Sq...</div>
                                <div class="nft-meta">Snowfro | ETH</div>
                            </div>
                        </div>
                        <div class="nft-item">
                            <div class="nft-preview">Abstract</div>
                            <div class="nft-info">
                                <div class="nft-name">Right Place ...</div>
                                <div class="nft-meta">XCOPY | ETH</div>
                            </div>
                        </div>
                        <div class="nft-item">
                            <div class="nft-preview">Portrait</div>
                            <div class="nft-info">
                                <div class="nft-name">Genesis</div>
                                <div class="nft-meta">Pak | ETH</div>
                            </div>
                        </div>
                        <div class="nft-item">
                            <div class="nft-preview">Landscape</div>
                            <div class="nft-info">
                                <div class="nft-name">Meridian #47</div>
                                <div class="nft-meta">Tyler Hobbs | ETH</div>
                            </div>
                        </div>
                        <div class="nft-item">
                            <div class="nft-preview">Photo</div>
                            <div class="nft-info">
                                <div class="nft-name">Objkt #12847</div>
                                <div class="nft-meta">Artist | XTZ</div>
                            </div>
                        </div>
                        <div class="nft-item">
                            <div class="nft-preview">Digital</div>
                            <div class="nft-info">
                                <div class="nft-name">Foundation ...</div>
                                <div class="nft-meta">Creator | ETH</div>
                            </div>
                        </div>
                    </div>

                    <div class="collection-score">
                        <div class="score-ring">
                            <span class="score-num">85</span>
                        </div>
                        <div class="score-text">
                            <div class="score-label">Collection Score</div>
                            <div class="score-desc">High authenticity. Strong witness depth.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SWAP & SEND TAB - Cross-Chain Decentralized Exchange
             THORChain + Chainflip - No KYC, No Custody, Truly Sovereign
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="tab-content" id="swap">
            <div class="swap-container">
                <!-- SWAP PANEL -->
                <div class="swap-panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 3l4 4-4 4"/><path d="M20 7H4"/><path d="M8 21l-4-4 4-4"/><path d="M4 17h16"/></svg>
                            Cross-Chain Swap
                        </div>
                        <span class="provider-badge" id="providerBadge">THORCHAIN</span>
                    </div>

                    <!-- Provider Selection -->
                    <div class="provider-toggle">
                        <button class="provider-btn active" onclick="selectProvider('thorchain')" id="btn-thorchain">
                            <span>‚ö°</span> THORChain
                        </button>
                        <button class="provider-btn" onclick="selectProvider('chainflip')" id="btn-chainflip">
                            <span>üîÑ</span> Chainflip
                        </button>
                        <button class="provider-btn" onclick="selectProvider('changelly')" id="btn-changelly">
                            <span>üí±</span> Changelly
                        </button>
                    </div>

                    <!-- From Token -->
                    <div class="token-box" id="fromToken">
                        <div class="token-box-label">From</div>
                        <div class="token-row">
                            <div class="token-select" onclick="toggleTokenDropdown('from', event)">
                                <div class="token-icon btc">‚Çø</div>
                                <div>
                                    <div class="token-name">BTC</div>
                                    <div class="token-chain">Bitcoin</div>
                                </div>
                                <svg class="token-dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                            </div>
                            <input type="number" class="token-input" id="fromAmount" placeholder="0.0" oninput="calculateSwap()">
                        </div>
                        <div class="token-balance">
                            <span>Balance: <span id="fromBalance">0.00</span></span>
                            <span class="max-btn" onclick="setMax('from')">MAX</span>
                        </div>
                        <div class="token-dropdown" id="fromDropdown" onclick="event.stopPropagation()">
                            <div class="token-option" onclick="selectToken('from', 'btc', 'BTC', 'Bitcoin', event)">
                                <div class="token-icon btc">‚Çø</div>
                                <div class="token-option-info"><div class="token-option-name">BTC</div><div class="token-option-chain">Bitcoin</div></div>
                                <div class="token-option-balance">0.00</div>
                            </div>
                            <div class="token-option" onclick="selectToken('from', 'eth', 'ETH', 'Ethereum', event)">
                                <div class="token-icon eth">Œû</div>
                                <div class="token-option-info"><div class="token-option-name">ETH</div><div class="token-option-chain">Ethereum</div></div>
                                <div class="token-option-balance">0.00</div>
                            </div>
                            <div class="token-option" onclick="selectToken('from', 'usdt', 'USDT', 'ERC-20', event)">
                                <div class="token-icon usdt">‚ÇÆ</div>
                                <div class="token-option-info"><div class="token-option-name">USDT</div><div class="token-option-chain">ERC-20</div></div>
                                <div class="token-option-balance">0.00</div>
                            </div>
                            <div class="token-option" onclick="selectToken('from', 'usdt_trc', 'USDT', 'TRC-20', event)">
                                <div class="token-icon usdt">‚ÇÆ</div>
                                <div class="token-option-info"><div class="token-option-name">USDT</div><div class="token-option-chain">TRC-20 (Tron)</div></div>
                                <div class="token-option-balance">0.00</div>
                            </div>
                            <div class="token-option" onclick="selectToken('from', 'xtz', 'XTZ', 'Tezos', event)">
                                <div class="token-icon xtz">Íú©</div>
                                <div class="token-option-info"><div class="token-option-name">XTZ</div><div class="token-option-chain">Tezos</div></div>
                                <div class="token-option-balance">0.00</div>
                            </div>
                            <div class="token-option" onclick="selectToken('from', 'matic', 'MATIC', 'Polygon', event)">
                                <div class="token-icon matic">M</div>
                                <div class="token-option-info"><div class="token-option-name">MATIC</div><div class="token-option-chain">Polygon</div></div>
                                <div class="token-option-balance">0.00</div>
                            </div>
                            <div class="token-option" onclick="selectToken('from', 'sol', 'SOL', 'Solana', event)">
                                <div class="token-icon sol">‚óé</div>
                                <div class="token-option-info"><div class="token-option-name">SOL</div><div class="token-option-chain">Solana</div></div>
                                <div class="token-option-balance">0.00</div>
                            </div>
                        </div>
                    </div>

                    <!-- Swap Arrow -->
                    <div class="swap-arrow">
                        <button class="swap-arrow-btn" onclick="swapTokens()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14"/><path d="M19 12l-7 7-7-7"/></svg>
                        </button>
                    </div>

                    <!-- To Token -->
                    <div class="token-box" id="toToken">
                        <div class="token-box-label">To</div>
                        <div class="token-row">
                            <div class="token-select" onclick="toggleTokenDropdown('to', event)">
                                <div class="token-icon usdt">‚ÇÆ</div>
                                <div>
                                    <div class="token-name">USDT</div>
                                    <div class="token-chain">ERC-20</div>
                                </div>
                                <svg class="token-dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg>
                            </div>
                            <input type="number" class="token-input" id="toAmount" placeholder="0.0" readonly>
                        </div>
                        <div class="token-balance">
                            <span>You receive (estimated)</span>
                        </div>
                        <div class="token-dropdown" id="toDropdown" onclick="event.stopPropagation()">
                            <div class="token-option" onclick="selectToken('to', 'btc', 'BTC', 'Bitcoin', event)">
                                <div class="token-icon btc">‚Çø</div>
                                <div class="token-option-info"><div class="token-option-name">BTC</div><div class="token-option-chain">Bitcoin</div></div>
                            </div>
                            <div class="token-option" onclick="selectToken('to', 'eth', 'ETH', 'Ethereum', event)">
                                <div class="token-icon eth">Œû</div>
                                <div class="token-option-info"><div class="token-option-name">ETH</div><div class="token-option-chain">Ethereum</div></div>
                            </div>
                            <div class="token-option" onclick="selectToken('to', 'usdt', 'USDT', 'ERC-20', event)">
                                <div class="token-icon usdt">‚ÇÆ</div>
                                <div class="token-option-info"><div class="token-option-name">USDT</div><div class="token-option-chain">ERC-20</div></div>
                            </div>
                            <div class="token-option" onclick="selectToken('to', 'usdt_trc', 'USDT', 'TRC-20', event)">
                                <div class="token-icon usdt">‚ÇÆ</div>
                                <div class="token-option-info"><div class="token-option-name">USDT</div><div class="token-option-chain">TRC-20 (Tron)</div></div>
                            </div>
                            <div class="token-option" onclick="selectToken('to', 'xtz', 'XTZ', 'Tezos', event)">
                                <div class="token-icon xtz">Íú©</div>
                                <div class="token-option-info"><div class="token-option-name">XTZ</div><div class="token-option-chain">Tezos</div></div>
                            </div>
                            <div class="token-option" onclick="selectToken('to', 'matic', 'MATIC', 'Polygon', event)">
                                <div class="token-icon matic">M</div>
                                <div class="token-option-info"><div class="token-option-name">MATIC</div><div class="token-option-chain">Polygon</div></div>
                            </div>
                            <div class="token-option" onclick="selectToken('to', 'sol', 'SOL', 'Solana', event)">
                                <div class="token-icon sol">‚óé</div>
                                <div class="token-option-info"><div class="token-option-name">SOL</div><div class="token-option-chain">Solana</div></div>
                            </div>
                        </div>
                    </div>

                    <!-- Rate Info -->
                    <div class="rate-info">
                        <div class="rate-row">
                            <span class="rate-label">Rate</span>
                            <span class="rate-value" id="swapRate">1 BTC ‚âà 94,500 USDT</span>
                        </div>
                        <div class="rate-row">
                            <span class="rate-label">Network Fee</span>
                            <span class="rate-value" id="networkFee">~$2.50</span>
                        </div>
                        <div class="rate-row">
                            <span class="rate-label">Slippage</span>
                            <span class="rate-value green" id="slippage">0.3%</span>
                        </div>
                        <div class="rate-row">
                            <span class="rate-label">Provider</span>
                            <span class="rate-value gold">THORChain</span>
                        </div>
                    </div>

                    <button class="swap-btn" id="swapBtn" onclick="initiateSwap()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 3l4 4-4 4"/><path d="M20 7H4"/><path d="M8 21l-4-4 4-4"/><path d="M4 17h16"/></svg>
                        Connect Wallet to Swap
                    </button>

                    <div class="sovereign-notice">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        Non-custodial swap. No KYC. Your keys, your coins.
                    </div>

                    <!-- Transaction Status -->
                    <div class="tx-status" id="txStatus">
                        <div class="tx-header">
                            <div class="tx-spinner"></div>
                            <span class="tx-title">Processing Swap...</span>
                        </div>
                        <div class="tx-steps">
                            <div class="tx-step complete" id="step1">
                                <svg class="tx-step-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9 12l2 2 4-4"/></svg>
                                Deposit received
                            </div>
                            <div class="tx-step active" id="step2">
                                <svg class="tx-step-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>
                                Swapping via THORChain
                            </div>
                            <div class="tx-step" id="step3">
                                <svg class="tx-step-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>
                                Sending to destination
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SEND PANEL -->
                <div class="send-panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                            Send Crypto
                        </div>
                    </div>

                    <!-- Balances -->
                    <div class="balances-grid" id="balancesGrid">
                        <div class="balance-card selected" data-token="btc" onclick="selectSendToken(this, 'btc')">
                            <div class="balance-top">
                                <div class="token-icon btc" style="width:22px;height:22px;font-size:0.6rem;">‚Çø</div>
                                <span class="balance-amount">0.00</span>
                            </div>
                            <div class="balance-usd">BTC ¬∑ $0.00</div>
                        </div>
                        <div class="balance-card" data-token="eth" onclick="selectSendToken(this, 'eth')">
                            <div class="balance-top">
                                <div class="token-icon eth" style="width:22px;height:22px;font-size:0.6rem;">Œû</div>
                                <span class="balance-amount">0.00</span>
                            </div>
                            <div class="balance-usd">ETH ¬∑ $0.00</div>
                        </div>
                        <div class="balance-card" data-token="usdt" onclick="selectSendToken(this, 'usdt')">
                            <div class="balance-top">
                                <div class="token-icon usdt" style="width:22px;height:22px;font-size:0.6rem;">‚ÇÆ</div>
                                <span class="balance-amount">0.00</span>
                            </div>
                            <div class="balance-usd">USDT ¬∑ $0.00</div>
                        </div>
                        <div class="balance-card" data-token="xtz" onclick="selectSendToken(this, 'xtz')">
                            <div class="balance-top">
                                <div class="token-icon xtz" style="width:22px;height:22px;font-size:0.6rem;">Íú©</div>
                                <span class="balance-amount">0.00</span>
                            </div>
                            <div class="balance-usd">XTZ ¬∑ $0.00</div>
                        </div>
                    </div>

                    <!-- Recipient Address -->
                    <div class="address-input-wrap">
                        <input type="text" class="address-input" id="recipientAddress" placeholder="Enter recipient address (0x... or tz1... or bc1...)">
                        <button class="qr-btn" onclick="scanQR()" title="Scan QR Code">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><path d="M14 14h3v3h-3z"/><path d="M17 17h4v4h-4z"/><path d="M14 17h3v4h-3z"/><path d="M17 14h4v3h-4z"/></svg>
                        </button>
                    </div>

                    <!-- Amount -->
                    <div class="token-box">
                        <div class="token-box-label">Amount to Send</div>
                        <div class="token-row">
                            <input type="number" class="token-input" id="sendAmount" placeholder="0.0" style="text-align:left;flex:1;">
                            <span class="max-btn" onclick="setMax('send')">MAX</span>
                        </div>
                        <div class="token-balance">
                            <span>Available: <span id="sendBalance">0.00 BTC</span></span>
                            <span>‚âà $<span id="sendUsd">0.00</span></span>
                        </div>
                    </div>

                    <!-- Send Button -->
                    <button class="send-btn" id="sendBtn" onclick="initiateSend()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                        Connect Wallet to Send
                    </button>

                    <div class="sovereign-notice">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        Direct transfer. No intermediaries. Verify address carefully.
                    </div>
                </div>
            </div>

            <!-- TRANSACTION HISTORY -->
            <div class="tx-history" id="txHistory">
                <div class="tx-history-header">
                    <span class="tx-history-title">Recent Transactions</span>
                    <button onclick="refreshHistory()" style="background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:0.75rem;">‚Üª Refresh</button>
                </div>
                <div class="tx-history-list" id="txHistoryList">
                    <div class="tx-history-empty">
                        Connect wallet to see transaction history
                    </div>
                </div>
            </div>

            <!-- WALLET CONNECTIONS -->
            <div class="tx-history" style="margin-top:0.75rem;">
                <div class="tx-history-header">
                    <span class="tx-history-title">Connected Wallets</span>
                </div>
                <div class="wallet-selector" id="walletSelector">
                    <div class="wallet-option" onclick="connectWallet('ethereum')" id="wallet-eth">
                        <div class="wallet-option-icon">ü¶ä</div>
                        <div class="wallet-option-name">Ethereum</div>
                        <div class="wallet-option-status" id="eth-status">Click to connect</div>
                    </div>
                    <div class="wallet-option" onclick="connectWallet('bitcoin')" id="wallet-btc">
                        <div class="wallet-option-icon">‚Çø</div>
                        <div class="wallet-option-name">Bitcoin</div>
                        <div class="wallet-option-status" id="btc-status">Click to connect</div>
                    </div>
                    <div class="wallet-option" onclick="connectWallet('tezos')" id="wallet-xtz">
                        <div class="wallet-option-icon">Íú©</div>
                        <div class="wallet-option-name">Tezos</div>
                        <div class="wallet-option-status" id="xtz-status">Click to connect</div>
                    </div>
                    <div class="wallet-option" onclick="connectWallet('solana')" id="wallet-sol">
                        <div class="wallet-option-icon">‚óé</div>
                        <div class="wallet-option-name">Solana</div>
                        <div class="wallet-option-status" id="sol-status">Click to connect</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="provenance">
            <div class="tab-placeholder">
                <h3>Deep Provenance Analysis</h3>
                <p>Select an NFT to analyze conceptual genealogy, witness depth, and artistic practice mapping.</p>
            </div>
        </div>

        <div class="tab-content" id="living">
            <div class="tab-placeholder">
                <h3>Living Works Tracker</h3>
                <p>Track dynamic NFTs across time: past states, current state, future scheduled events.</p>
            </div>
        </div>

        <div class="tab-content" id="network">
            <div class="tab-placeholder">
                <h3>Collector Network</h3>
                <p>Discover collectors with similar taste profiles and artists you might connect with.</p>
            </div>
        </div>
    </main>

    <footer class="footer">
        ARC-8 | NFT-8 Collector | <a href="/">Home</a> | Your Data. Your Future.
    </footer>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // NFT-8 SWAP & SEND - REAL Cross-Chain Decentralized Exchange
        // THORChain Integration - Production Ready
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Tab Navigation
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        document.querySelectorAll('.collection-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.collection-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
            });
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // THORCHAIN CONFIGURATION - REAL API ENDPOINTS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const THORCHAIN_API = 'https://thornode.ninerealms.com/thorchain';
        const MIDGARD_API = 'https://midgard.ninerealms.com/v2';

        // THORChain asset identifiers (REAL)
        const THORCHAIN_ASSETS = {
            btc: 'BTC.BTC',
            eth: 'ETH.ETH',
            usdt_erc20: 'ETH.USDT-0XDAC17F958D2EE523A2206206994597C13D831EC7',
            usdc: 'ETH.USDC-0XA0B86991C6218B36C1D19D4A2E9EB0CE3606EB48',
            matic: 'ETH.MATIC-0X7D1AFA7B718FB893DB30A3ABC0CFC608AACFEBB0',
            // Note: Tezos not supported by THORChain - would need Chainflip
        };

        // Minimum swap amounts (in USD) - THORChain requirement
        const MIN_SWAP_USD = 50;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SWAP STATE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const swapState = {
            from: { token: 'btc', symbol: 'BTC', chain: 'Bitcoin', balance: 0, thorId: 'BTC.BTC', decimals: 8 },
            to: { token: 'usdt', symbol: 'USDT', chain: 'ERC-20', balance: 0, thorId: 'ETH.USDT-0XDAC17F958D2EE523A2206206994597C13D831EC7', decimals: 6 },
            sendToken: 'eth',
            walletConnected: false,
            walletAddress: null,
            quote: null,
            prices: { btc: 94500, eth: 3200, usdt: 1, usdc: 1, xtz: 1.2, matic: 0.85, sol: 180 },
            balances: { btc: 0, eth: 0, usdt: 0, usdc: 0, xtz: 0, matic: 0, sol: 0 }
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // TOKEN SELECTION WITH THORCHAIN IDs
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const TOKEN_CONFIG = {
            btc: { symbol: 'BTC', chain: 'Bitcoin', thorId: 'BTC.BTC', decimals: 8 },
            eth: { symbol: 'ETH', chain: 'Ethereum', thorId: 'ETH.ETH', decimals: 18 },
            usdt: { symbol: 'USDT', chain: 'ERC-20', thorId: 'ETH.USDT-0XDAC17F958D2EE523A2206206994597C13D831EC7', decimals: 6 },
            usdt_trc: { symbol: 'USDT', chain: 'TRC-20', thorId: null, decimals: 6, note: 'Use Tron wallet' },
            usdc: { symbol: 'USDC', chain: 'ERC-20', thorId: 'ETH.USDC-0XA0B86991C6218B36C1D19D4A2E9EB0CE3606EB48', decimals: 6 },
            matic: { symbol: 'MATIC', chain: 'Polygon', thorId: 'ETH.MATIC-0X7D1AFA7B718FB893DB30A3ABC0CFC608AACFEBB0', decimals: 18 },
            xtz: { symbol: 'XTZ', chain: 'Tezos', thorId: null, decimals: 6, note: 'THORChain does not support Tezos - use Changelly' },
            sol: { symbol: 'SOL', chain: 'Solana', thorId: null, decimals: 9, note: 'THORChain does not support Solana - use Changelly' }
        };

        function toggleTokenDropdown(type, event) {
            // Prevent event from bubbling to document click handler
            if (event) {
                event.stopPropagation();
            }

            const dropdown = document.getElementById(`${type}Dropdown`);

            // Close other dropdowns first
            document.querySelectorAll('.token-dropdown').forEach(d => {
                if (d !== dropdown) d.classList.remove('show');
            });

            // Toggle this dropdown
            dropdown.classList.toggle('show');

            // Update dropdown balances when opening
            if (dropdown.classList.contains('show')) {
                updateDropdownBalances(type);
            }

            console.log(`Dropdown ${type} toggled:`, dropdown.classList.contains('show') ? 'OPEN' : 'CLOSED');
        }

        function updateDropdownBalances(type) {
            const dropdown = document.getElementById(`${type}Dropdown`);
            const options = dropdown.querySelectorAll('.token-option');

            options.forEach(option => {
                const tokenName = option.querySelector('.token-option-name')?.textContent?.toLowerCase();
                if (tokenName && swapState.balances[tokenName] !== undefined) {
                    const balanceEl = option.querySelector('.token-option-balance');
                    if (balanceEl) {
                        const bal = swapState.balances[tokenName];
                        balanceEl.textContent = bal > 0 ? bal.toFixed(bal > 100 ? 2 : 6) : '0.00';
                    }
                }
            });
        }

        function selectToken(type, tokenId, symbol, chain, event) {
            // Prevent event from bubbling
            if (event) {
                event.stopPropagation();
            }

            console.log(`Selecting ${type} token:`, tokenId, symbol, chain);

            const config = TOKEN_CONFIG[tokenId] || { symbol, chain, thorId: null, decimals: 18 };
            swapState[type] = {
                token: tokenId,
                symbol: config.symbol,
                chain: chain || config.chain,
                balance: swapState.balances[tokenId] || 0,
                thorId: config.thorId,
                decimals: config.decimals
            };

            const box = document.getElementById(`${type}Token`);
            const icon = box.querySelector('.token-icon');
            const nameEl = box.querySelector('.token-name');
            const chainEl = box.querySelector('.token-chain');

            // Update icon class and symbol
            const baseToken = tokenId.split('_')[0];
            icon.className = `token-icon ${baseToken}`;
            icon.textContent = getTokenSymbol(tokenId);
            nameEl.textContent = config.symbol;
            chainEl.textContent = chain || config.chain;

            // Update balance display
            if (type === 'from') {
                const balance = swapState.balances[tokenId] || 0;
                document.getElementById('fromBalance').textContent = balance.toFixed(balance > 100 ? 2 : 6);
            }

            // Close dropdown
            document.getElementById(`${type}Dropdown`).classList.remove('show');

            // Check provider support for this pair
            if (typeof checkPairSupport === 'function') {
                checkPairSupport();
            }

            // Fetch new quote with current provider
            if (typeof fetchQuoteForProvider === 'function') {
                fetchQuoteForProvider();
            } else {
                fetchThorchainQuote();
            }

            console.log(`Token selected - From: ${swapState.from.symbol}, To: ${swapState.to.symbol}`);
        }

        function getTokenSymbol(token) {
            const symbols = {
                btc: '‚Çø',
                eth: 'Œû',
                usdt: '‚ÇÆ',
                usdc: '$',
                xtz: 'Íú©',
                matic: 'M',
                sol: '‚óé',
                dot: '‚óè'
            };
            return symbols[token.split('_')[0]] || token.charAt(0).toUpperCase();
        }

        function swapTokens() {
            const temp = { ...swapState.from };
            swapState.from = { ...swapState.to };
            swapState.to = temp;

            ['from', 'to'].forEach(type => {
                const box = document.getElementById(`${type}Token`);
                const icon = box.querySelector('.token-icon');
                const nameEl = box.querySelector('.token-name');
                const chainEl = box.querySelector('.token-chain');
                const state = swapState[type];

                icon.className = `token-icon ${state.token.split('_')[0]}`;
                icon.textContent = getTokenSymbol(state.token);
                nameEl.textContent = state.symbol;
                chainEl.textContent = state.chain;
            });

            const fromInput = document.getElementById('fromAmount');
            const toInput = document.getElementById('toAmount');
            fromInput.value = toInput.value;
            fetchThorchainQuote();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // REAL THORCHAIN QUOTE API
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let quoteTimeout = null;

        async function fetchThorchainQuote() {
            const fromAmount = parseFloat(document.getElementById('fromAmount').value) || 0;

            if (fromAmount <= 0) {
                document.getElementById('toAmount').value = '';
                document.getElementById('swapRate').textContent = 'Enter amount for quote';
                return;
            }

            // Check THORChain support
            if (!swapState.from.thorId || !swapState.to.thorId) {
                document.getElementById('swapRate').textContent = '‚ö†Ô∏è Pair not supported by THORChain';
                document.getElementById('toAmount').value = '';
                return;
            }

            // Debounce API calls
            clearTimeout(quoteTimeout);
            quoteTimeout = setTimeout(() => _fetchQuote(fromAmount), 500);
        }

        async function _fetchQuote(fromAmount) {
            const fromDecimals = swapState.from.decimals || 8;
            const toDecimals = swapState.to.decimals || 8;

            // Convert to base units (THORChain uses 8 decimal places internally)
            const amountInBaseUnits = Math.floor(fromAmount * Math.pow(10, 8));

            document.getElementById('swapRate').textContent = 'Fetching quote...';

            try {
                // REAL THORChain Quote API
                const quoteUrl = `${THORCHAIN_API}/quote/swap?from_asset=${swapState.from.thorId}&to_asset=${swapState.to.thorId}&amount=${amountInBaseUnits}&destination=${swapState.walletAddress || 'PLACEHOLDER'}`;

                console.log('Fetching THORChain quote:', quoteUrl);

                const response = await fetch(quoteUrl);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP ${response.status}`);
                }

                const quote = await response.json();
                swapState.quote = quote;

                console.log('THORChain Quote:', quote);

                // Parse response
                const expectedOutput = parseInt(quote.expected_amount_out) / Math.pow(10, 8);
                const fees = parseInt(quote.fees?.total || 0) / Math.pow(10, 8);
                const slippageBps = quote.slippage_bps || 0;

                // Update UI with REAL data
                document.getElementById('toAmount').value = expectedOutput.toFixed(expectedOutput > 100 ? 2 : 6);
                document.getElementById('swapRate').textContent =
                    `1 ${swapState.from.symbol} ‚âà ${(expectedOutput / fromAmount).toFixed(4)} ${swapState.to.symbol}`;
                document.getElementById('networkFee').textContent =
                    `${fees.toFixed(6)} ${swapState.to.symbol} (~$${(fees * swapState.prices[swapState.to.token]).toFixed(2)})`;
                document.getElementById('slippage').textContent = `${(slippageBps / 100).toFixed(2)}%`;
                document.getElementById('slippage').className = slippageBps > 100 ? 'rate-value rose' : 'rate-value green';

                // Store inbound address for actual swap
                swapState.inboundAddress = quote.inbound_address;
                swapState.memo = quote.memo;
                swapState.expectedOutput = expectedOutput;

                // Check minimum
                const valueUsd = fromAmount * swapState.prices[swapState.from.token];
                if (valueUsd < MIN_SWAP_USD) {
                    document.getElementById('swapRate').textContent += ` ‚ö†Ô∏è Min ~$${MIN_SWAP_USD}`;
                }

            } catch (error) {
                console.error('THORChain quote error:', error);
                document.getElementById('swapRate').textContent = `Quote error: ${error.message}`;
                document.getElementById('toAmount').value = '';

                // Fallback to price-based estimate
                fallbackQuote(fromAmount);
            }
        }

        function fallbackQuote(fromAmount) {
            const fromPrice = swapState.prices[swapState.from.token] || 1;
            const toPrice = swapState.prices[swapState.to.token] || 1;
            const rate = fromPrice / toPrice;
            const output = fromAmount * rate * 0.97; // 3% buffer for fees

            document.getElementById('toAmount').value = output.toFixed(output > 100 ? 2 : 6);
            document.getElementById('swapRate').textContent =
                `~${(rate).toFixed(2)} (estimate - connect wallet for live quote)`;
        }

        // Trigger quote calculation on input
        function calculateSwap() {
            fetchThorchainQuote();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // REAL WALLET CONNECTION & BALANCE FETCHING
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        async function connectWallet() {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    // Request accounts
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    swapState.walletConnected = true;
                    swapState.walletAddress = accounts[0];

                    console.log('Wallet connected:', swapState.walletAddress);

                    // Get chain ID
                    const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                    console.log('Chain ID:', chainId);

                    updateWalletUI();
                    await fetchRealBalances();

                    // Re-fetch quote with real destination address
                    fetchThorchainQuote();

                    // Listen for account changes
                    window.ethereum.on('accountsChanged', async (accounts) => {
                        if (accounts.length > 0) {
                            swapState.walletAddress = accounts[0];
                            await fetchRealBalances();
                        } else {
                            swapState.walletConnected = false;
                            swapState.walletAddress = null;
                            updateWalletUI();
                        }
                    });

                    return true;
                } else {
                    // Show wallet options
                    showWalletOptions();
                    return false;
                }
            } catch (error) {
                console.error('Wallet connection failed:', error);
                alert('Failed to connect wallet: ' + error.message);
                return false;
            }
        }

        function showWalletOptions() {
            const msg = `No wallet detected. Install one of:\n
‚Ä¢ MetaMask (recommended): metamask.io
‚Ä¢ Rabby Wallet: rabby.io
‚Ä¢ Coinbase Wallet: coinbase.com/wallet

For BTC swaps, you'll need a Bitcoin address to receive funds.`;
            alert(msg);
        }

        async function fetchRealBalances() {
            if (!swapState.walletAddress) return;

            try {
                // Fetch ETH balance
                const ethBalance = await window.ethereum.request({
                    method: 'eth_getBalance',
                    params: [swapState.walletAddress, 'latest']
                });
                swapState.balances.eth = parseInt(ethBalance, 16) / 1e18;

                // Fetch ERC-20 balances (USDT, USDC, MATIC on ETH)
                const erc20Tokens = {
                    usdt: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                    usdc: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48',
                    matic: '0x7D1AfA7B718fb893dB30A3aBc0Cfc608AaCfeBB0'
                };

                for (const [token, address] of Object.entries(erc20Tokens)) {
                    try {
                        const balance = await getERC20Balance(address, swapState.walletAddress);
                        swapState.balances[token] = balance;
                    } catch (e) {
                        console.log(`Could not fetch ${token} balance:`, e.message);
                    }
                }

                // Update UI with real balances
                updateBalanceUI();

            } catch (error) {
                console.error('Error fetching balances:', error);
            }
        }

        async function getERC20Balance(tokenAddress, walletAddress) {
            // balanceOf(address) function signature
            const data = '0x70a08231' + walletAddress.slice(2).padStart(64, '0');

            const result = await window.ethereum.request({
                method: 'eth_call',
                params: [{
                    to: tokenAddress,
                    data: data
                }, 'latest']
            });

            // USDT/USDC have 6 decimals
            return parseInt(result, 16) / 1e6;
        }

        function updateBalanceUI() {
            // Update swap panel balance
            const fromBal = swapState.balances[swapState.from.token] || 0;
            document.getElementById('fromBalance').textContent = fromBal.toFixed(fromBal > 100 ? 2 : 6);

            // Update send panel balances
            document.querySelectorAll('.balance-card').forEach(card => {
                const token = card.dataset.token;
                const balance = swapState.balances[token] || 0;
                const usdValue = balance * (swapState.prices[token] || 0);

                card.querySelector('.balance-amount').textContent = balance.toFixed(balance > 100 ? 2 : 6);
                card.querySelector('.balance-usd').textContent =
                    `${token.toUpperCase()} ¬∑ $${usdValue.toFixed(2)}`;
            });

            // Update send balance display
            const sendToken = swapState.sendToken;
            const sendBal = swapState.balances[sendToken] || 0;
            document.getElementById('sendBalance').textContent =
                `${sendBal.toFixed(sendBal > 100 ? 2 : 6)} ${sendToken.toUpperCase()}`;
        }

        function updateWalletUI() {
            const swapBtn = document.getElementById('swapBtn');
            const sendBtn = document.getElementById('sendBtn');

            if (swapState.walletConnected) {
                const shortAddr = `${swapState.walletAddress.slice(0,6)}...${swapState.walletAddress.slice(-4)}`;
                swapBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 3l4 4-4 4"/><path d="M20 7H4"/><path d="M8 21l-4-4 4-4"/><path d="M4 17h16"/></svg>
                    Get Deposit Address
                `;
                sendBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13"/><path d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>
                    Send (${shortAddr})
                `;
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // REAL SWAP EXECUTION - THORChain Deposit Flow
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        async function initiateSwap() {
            // First, ensure wallet is connected
            if (!swapState.walletConnected) {
                const connected = await connectWallet();
                if (!connected) return;
            }

            const fromAmount = parseFloat(document.getElementById('fromAmount').value);
            if (!fromAmount || fromAmount <= 0) {
                alert('Please enter an amount to swap');
                return;
            }

            // Check THORChain support
            if (!swapState.from.thorId || !swapState.to.thorId) {
                alert(`Swap pair not supported by THORChain.\n\n${swapState.from.symbol} ‚Üí ${swapState.to.symbol} requires a different provider.`);
                return;
            }

            // Check minimum
            const valueUsd = fromAmount * swapState.prices[swapState.from.token];
            if (valueUsd < MIN_SWAP_USD) {
                alert(`Minimum swap amount is ~$${MIN_SWAP_USD} USD.\nYour swap: $${valueUsd.toFixed(2)}`);
                return;
            }

            // Check balance
            const balance = swapState.balances[swapState.from.token] || 0;
            if (fromAmount > balance) {
                alert(`Insufficient balance.\nYou have: ${balance.toFixed(6)} ${swapState.from.symbol}\nTrying to swap: ${fromAmount} ${swapState.from.symbol}`);
                return;
            }

            // Ensure we have a fresh quote
            if (!swapState.quote || !swapState.inboundAddress) {
                alert('Please wait for quote to load...');
                await fetchThorchainQuote();
                return;
            }

            // SHOW DEPOSIT INSTRUCTIONS
            showDepositInstructions();
        }

        function showDepositInstructions() {
            const fromAmount = parseFloat(document.getElementById('fromAmount').value);
            const quote = swapState.quote;

            // Create modal with deposit instructions
            const modal = document.createElement('div');
            modal.id = 'depositModal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.9); z-index: 9999;
                display: flex; align-items: center; justify-content: center;
                padding: 1rem;
            `;

            modal.innerHTML = `
                <div style="background: var(--panel); border: 1px solid var(--gold); border-radius: 12px; padding: 1.5rem; max-width: 500px; width: 100%;">
                    <h3 style="color: var(--gold); margin-bottom: 1rem; font-size: 1.2rem;">
                        üîÑ THORChain Swap Instructions
                    </h3>

                    <div style="background: var(--surface); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem;">SEND EXACTLY:</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--text);">
                            ${fromAmount} ${swapState.from.symbol}
                        </div>
                    </div>

                    <div style="background: var(--surface); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem;">TO THIS ADDRESS:</div>
                        <div style="font-family: monospace; font-size: 0.85rem; color: var(--gold); word-break: break-all; padding: 0.5rem; background: var(--void); border-radius: 4px;">
                            ${swapState.inboundAddress}
                        </div>
                        <button onclick="copyToClipboard('${swapState.inboundAddress}')" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: var(--gold-dim); border: none; border-radius: 4px; color: var(--void); cursor: pointer; font-size: 0.8rem;">
                            üìã Copy Address
                        </button>
                    </div>

                    <div style="background: var(--surface); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.5rem;">WITH MEMO:</div>
                        <div style="font-family: monospace; font-size: 0.75rem; color: var(--emerald); word-break: break-all; padding: 0.5rem; background: var(--void); border-radius: 4px;">
                            ${swapState.memo}
                        </div>
                        <button onclick="copyToClipboard('${swapState.memo}')" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: var(--gold-dim); border: none; border-radius: 4px; color: var(--void); cursor: pointer; font-size: 0.8rem;">
                            üìã Copy Memo
                        </button>
                    </div>

                    <div style="background: rgba(84,168,118,0.1); border: 1px solid var(--emerald); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div style="font-size: 0.9rem; color: var(--emerald); font-weight: 600;">YOU WILL RECEIVE:</div>
                        <div style="font-size: 1.3rem; font-weight: 700; color: var(--text);">
                            ~${swapState.expectedOutput?.toFixed(6)} ${swapState.to.symbol}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">
                            To: ${swapState.walletAddress}
                        </div>
                    </div>

                    <div style="background: rgba(186,101,135,0.1); border: 1px solid var(--rose); padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; font-size: 0.8rem; color: var(--rose);">
                        ‚ö†Ô∏è <strong>IMPORTANT:</strong><br>
                        ‚Ä¢ The MEMO is required for the swap to work<br>
                        ‚Ä¢ Send from a wallet you control (not an exchange)<br>
                        ‚Ä¢ Swap takes 10-30 minutes depending on chain confirmations<br>
                        ‚Ä¢ Quote expires in ~10 minutes
                    </div>

                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="closeDepositModal()" style="flex: 1; padding: 0.75rem; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; color: var(--text); cursor: pointer;">
                            Cancel
                        </button>
                        <button onclick="trackSwapStatus()" style="flex: 1; padding: 0.75rem; background: var(--gold); border: none; border-radius: 8px; color: var(--void); cursor: pointer; font-weight: 600;">
                            I've Sent - Track Status
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            }).catch(err => {
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Copied to clipboard!');
            });
        }

        function closeDepositModal() {
            const modal = document.getElementById('depositModal');
            if (modal) modal.remove();
        }

        async function trackSwapStatus() {
            closeDepositModal();

            // Show tracking UI
            document.getElementById('txStatus').classList.add('show');

            // In production, poll THORChain for status
            alert(`Swap submitted!\n\nTrack your swap at:\nhttps://track.ninerealms.com/\n\nOr check THORChain explorer for your transaction.\n\nThis window will update when the swap completes.`);

            // Start polling for status
            pollSwapStatus();
        }

        async function pollSwapStatus() {
            // Poll Midgard API for transaction status
            // This would check: https://midgard.ninerealms.com/v2/actions?address=YOUR_ADDRESS

            const checkStatus = async () => {
                try {
                    const response = await fetch(`${MIDGARD_API}/actions?address=${swapState.walletAddress}&limit=1`);
                    const data = await response.json();

                    if (data.actions && data.actions.length > 0) {
                        const action = data.actions[0];
                        console.log('Swap status:', action.status);

                        if (action.status === 'success') {
                            document.getElementById('step1').className = 'tx-step complete';
                            document.getElementById('step2').className = 'tx-step complete';
                            document.getElementById('step3').className = 'tx-step complete';
                            alert('Swap complete! Check your wallet for the received tokens.');
                            return true;
                        }
                    }
                } catch (e) {
                    console.log('Status check error:', e);
                }
                return false;
            };

            // Poll every 30 seconds for 30 minutes
            let attempts = 0;
            const maxAttempts = 60;

            const poll = setInterval(async () => {
                attempts++;
                const complete = await checkStatus();

                if (complete || attempts >= maxAttempts) {
                    clearInterval(poll);
                    if (!complete && attempts >= maxAttempts) {
                        console.log('Polling timeout - check THORChain explorer manually');
                    }
                }
            }, 30000);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // REAL SEND FUNCTIONALITY - Direct Blockchain Transfer
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function selectSendToken(element, token) {
            document.querySelectorAll('.balance-card').forEach(c => c.classList.remove('selected'));
            element.classList.add('selected');
            swapState.sendToken = token;

            // Update send balance display
            const balance = swapState.balances[token] || 0;
            document.getElementById('sendBalance').textContent =
                `${balance.toFixed(balance > 100 ? 2 : 6)} ${token.toUpperCase()}`;
            document.getElementById('sendUsd').textContent =
                (balance * (swapState.prices[token] || 0)).toFixed(2);
        }

        async function initiateSend() {
            if (!swapState.walletConnected) {
                const connected = await connectWallet();
                if (!connected) return;
            }

            const address = document.getElementById('recipientAddress').value.trim();
            const amount = parseFloat(document.getElementById('sendAmount').value);

            if (!address) {
                alert('Please enter a recipient address');
                return;
            }

            if (!amount || amount <= 0) {
                alert('Please enter an amount to send');
                return;
            }

            // Validate address format
            if (!validateAddress(address, swapState.sendToken)) {
                alert(`Invalid address format for ${swapState.sendToken.toUpperCase()}`);
                return;
            }

            // Check balance
            const balance = swapState.balances[swapState.sendToken] || 0;
            if (amount > balance) {
                alert(`Insufficient balance.\nYou have: ${balance.toFixed(6)} ${swapState.sendToken.toUpperCase()}\nTrying to send: ${amount}`);
                return;
            }

            // EXECUTE REAL SEND
            await executeSend(address, amount);
        }

        async function executeSend(toAddress, amount) {
            const token = swapState.sendToken;

            try {
                let txHash;

                if (token === 'eth') {
                    // Send ETH
                    const amountWei = '0x' + Math.floor(amount * 1e18).toString(16);

                    txHash = await window.ethereum.request({
                        method: 'eth_sendTransaction',
                        params: [{
                            from: swapState.walletAddress,
                            to: toAddress,
                            value: amountWei,
                            gas: '0x5208' // 21000 gas for ETH transfer
                        }]
                    });

                } else if (['usdt', 'usdc', 'matic'].includes(token)) {
                    // Send ERC-20 token
                    const tokenAddresses = {
                        usdt: '0xdAC17F958D2ee523a2206206994597C13D831ec7',
                        usdc: '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48',
                        matic: '0x7D1AfA7B718fb893dB30A3aBc0Cfc608AaCfeBB0'
                    };
                    const tokenAddress = tokenAddresses[token];
                    const decimals = token === 'matic' ? 18 : 6;
                    const amountBase = Math.floor(amount * Math.pow(10, decimals));

                    // ERC-20 transfer(address,uint256) function
                    const data = '0xa9059cbb' +
                        toAddress.slice(2).padStart(64, '0') +
                        amountBase.toString(16).padStart(64, '0');

                    txHash = await window.ethereum.request({
                        method: 'eth_sendTransaction',
                        params: [{
                            from: swapState.walletAddress,
                            to: tokenAddress,
                            data: data,
                            gas: '0x186A0' // 100000 gas for ERC-20 transfer
                        }]
                    });

                } else if (token === 'btc') {
                    // BTC requires external wallet - show instructions
                    alert(`To send BTC:\n\n1. Open your Bitcoin wallet\n2. Send ${amount} BTC to:\n${toAddress}\n\nBitcoin cannot be sent directly from MetaMask.`);
                    return;

                } else if (token === 'xtz') {
                    // Tezos requires Temple or similar
                    if (typeof window.tezos !== 'undefined') {
                        // Use Tezos wallet
                        const operation = await window.tezos.wallet.transfer({
                            to: toAddress,
                            amount: amount * 1e6 // mutez
                        }).send();
                        txHash = operation.opHash;
                    } else {
                        alert('Please install Temple wallet for Tezos transactions');
                        return;
                    }
                }

                if (txHash) {
                    console.log('Transaction sent:', txHash);
                    alert(`Transaction submitted!\n\nTx Hash: ${txHash}\n\nTrack on Etherscan:\nhttps://etherscan.io/tx/${txHash}`);

                    // Refresh balances after a delay
                    setTimeout(fetchRealBalances, 10000);
                }

            } catch (error) {
                console.error('Send failed:', error);

                if (error.code === 4001) {
                    alert('Transaction rejected by user');
                } else if (error.code === -32603) {
                    alert('Transaction failed: ' + (error.message || 'Insufficient funds for gas'));
                } else {
                    alert('Send failed: ' + error.message);
                }
            }
        }

        function validateAddress(address, token) {
            const patterns = {
                btc: /^(bc1|[13])[a-zA-HJ-NP-Z0-9]{25,62}$/,
                eth: /^0x[a-fA-F0-9]{40}$/,
                usdt: /^0x[a-fA-F0-9]{40}$/,
                usdc: /^0x[a-fA-F0-9]{40}$/,
                xtz: /^tz[123][a-zA-Z0-9]{33}$|^KT1[a-zA-Z0-9]{33}$/,
                matic: /^0x[a-fA-F0-9]{40}$/
            };
            return patterns[token]?.test(address) ?? false;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // QR CODE SCANNER
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        async function scanQR() {
            // Check if browser supports camera
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                try {
                    // For now, use prompt - full QR would require a library like jsQR
                    const address = prompt('üì∑ QR Scanner coming soon!\n\nFor now, paste the recipient address:');
                    if (address) {
                        document.getElementById('recipientAddress').value = address.trim();
                    }
                } catch (e) {
                    const address = prompt('Paste or enter the recipient address:');
                    if (address) {
                        document.getElementById('recipientAddress').value = address.trim();
                    }
                }
            } else {
                const address = prompt('Paste or enter the recipient address:');
                if (address) {
                    document.getElementById('recipientAddress').value = address.trim();
                }
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MAX BUTTON - Sets to actual balance minus gas
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function setMax(type) {
            if (!swapState.walletConnected) {
                alert('Connect wallet to see balance');
                return;
            }

            const token = type === 'send' ? swapState.sendToken : swapState.from.token;
            let balance = swapState.balances[token] || 0;

            // Reserve gas for ETH transactions
            if (token === 'eth' && balance > 0.01) {
                balance = balance - 0.005; // Reserve 0.005 ETH for gas
            }

            const inputId = type === 'send' ? 'sendAmount' : 'fromAmount';
            document.getElementById(inputId).value = balance.toFixed(balance > 100 ? 2 : 6);

            if (type !== 'send') {
                fetchThorchainQuote();
            } else {
                // Update USD value
                document.getElementById('sendUsd').textContent =
                    (balance * (swapState.prices[token] || 0)).toFixed(2);
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CLOSE DROPDOWNS ON OUTSIDE CLICK
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        document.addEventListener('click', (e) => {
            // Don't close if clicking on dropdown or token-select
            const isDropdown = e.target.closest('.token-dropdown');
            const isTokenSelect = e.target.closest('.token-select');

            if (!isDropdown && !isTokenSelect) {
                document.querySelectorAll('.token-dropdown').forEach(d => d.classList.remove('show'));
            }
        });

        // Close dropdowns on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.token-dropdown').forEach(d => d.classList.remove('show'));
            }
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // FETCH LIVE PRICES FROM COINGECKO
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        async function fetchLivePrices() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,tether,tezos,matic-network,usd-coin&vs_currencies=usd');
                const data = await response.json();
                swapState.prices = {
                    btc: data.bitcoin?.usd || 94500,
                    eth: data.ethereum?.usd || 3200,
                    usdt: data.tether?.usd || 1,
                    usdc: data['usd-coin']?.usd || 1,
                    xtz: data.tezos?.usd || 1.2,
                    matic: data['matic-network']?.usd || 0.85
                };
                console.log('Live prices fetched:', swapState.prices);
            } catch (error) {
                console.log('Using cached prices:', error.message);
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // INITIALIZATION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('NFT-8 Swap & Send initialized');

            // Fetch live prices
            await fetchLivePrices();

            // Check if wallet is already connected
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        swapState.walletConnected = true;
                        swapState.walletAddress = accounts[0];
                        updateWalletUI();
                        await fetchRealBalances();
                        console.log('Wallet auto-connected:', swapState.walletAddress);
                    }
                } catch (e) {
                    console.log('No wallet auto-connect');
                }
            }

            // Update prices every 60 seconds
            setInterval(fetchLivePrices, 60000);
        });

        // Log that real swap is enabled
        console.log('üîÑ THORChain Integration: ENABLED');
        console.log('üì° API Endpoints:', { THORCHAIN_API, MIDGARD_API });
        console.log('‚ö†Ô∏è IMPORTANT: Test with small amounts first!');

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MULTI-PROVIDER SUPPORT - THORChain, Chainflip, Changelly
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const CHAINFLIP_API = 'https://chainflip-swap.chainflip.io/quote';
        const CHANGELLY_API = 'https://api.changelly.com/v2';

        // Provider configurations
        const PROVIDERS = {
            thorchain: {
                name: 'THORChain',
                supports: ['btc', 'eth', 'usdt', 'usdc', 'matic'],
                doesNotSupport: ['xtz', 'usdt_trc', 'sol'],
                minUsd: 50,
                description: 'Decentralized, non-custodial'
            },
            chainflip: {
                name: 'Chainflip',
                supports: ['btc', 'eth', 'usdt', 'usdc', 'dot', 'flip'],
                doesNotSupport: ['xtz', 'matic'],
                minUsd: 25,
                description: 'Native cross-chain swaps'
            },
            changelly: {
                name: 'Changelly',
                supports: ['btc', 'eth', 'usdt', 'usdc', 'xtz', 'matic', 'sol', 'usdt_trc'],
                doesNotSupport: [],
                minUsd: 10,
                description: 'Wide asset support'
            }
        };

        let currentProvider = 'thorchain';

        function selectProvider(provider) {
            currentProvider = provider;

            // Update button states
            document.querySelectorAll('.provider-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`btn-${provider}`).classList.add('active');

            // Update badge
            document.getElementById('providerBadge').textContent = PROVIDERS[provider].name.toUpperCase();

            // Update rate display
            const rateRows = document.querySelectorAll('.rate-row');
            rateRows.forEach(row => {
                const label = row.querySelector('.rate-label');
                if (label && label.textContent === 'Provider') {
                    row.querySelector('.rate-value').textContent = PROVIDERS[provider].name;
                }
            });

            // Check if current pair is supported
            checkPairSupport();

            // Refetch quote with new provider
            if (document.getElementById('fromAmount').value) {
                fetchQuoteForProvider();
            }

            console.log('Provider switched to:', provider);
        }

        function checkPairSupport() {
            const fromToken = swapState.from.token;
            const toToken = swapState.to.token;
            const provider = PROVIDERS[currentProvider];

            const fromSupported = provider.supports.includes(fromToken);
            const toSupported = provider.supports.includes(toToken);

            const swapBtn = document.getElementById('swapBtn');

            if (!fromSupported || !toSupported) {
                const unsupported = !fromSupported ? swapState.from.symbol : swapState.to.symbol;
                document.getElementById('swapRate').innerHTML =
                    `‚ö†Ô∏è ${unsupported} not supported by ${provider.name}. Try <span style="color:var(--gold);cursor:pointer;" onclick="suggestProvider('${fromToken}', '${toToken}')">another provider</span>`;
                swapBtn.disabled = true;
            } else {
                swapBtn.disabled = false;
            }
        }

        function suggestProvider(fromToken, toToken) {
            // Find provider that supports both tokens
            for (const [key, provider] of Object.entries(PROVIDERS)) {
                if (provider.supports.includes(fromToken) && provider.supports.includes(toToken)) {
                    selectProvider(key);
                    return;
                }
            }
            alert('No provider supports this pair. Try swapping via a common token like ETH or USDT.');
        }

        async function fetchQuoteForProvider() {
            const fromAmount = parseFloat(document.getElementById('fromAmount').value) || 0;
            if (fromAmount <= 0) return;

            switch (currentProvider) {
                case 'thorchain':
                    await fetchThorchainQuote();
                    break;
                case 'chainflip':
                    await fetchChainflipQuote(fromAmount);
                    break;
                case 'changelly':
                    await fetchChangellyQuote(fromAmount);
                    break;
            }
        }

        async function fetchChainflipQuote(fromAmount) {
            // Chainflip asset mapping
            const CHAINFLIP_ASSETS = {
                btc: { chain: 'Bitcoin', asset: 'BTC' },
                eth: { chain: 'Ethereum', asset: 'ETH' },
                usdt: { chain: 'Ethereum', asset: 'USDT' },
                usdc: { chain: 'Ethereum', asset: 'USDC' }
            };

            const from = CHAINFLIP_ASSETS[swapState.from.token];
            const to = CHAINFLIP_ASSETS[swapState.to.token];

            if (!from || !to) {
                document.getElementById('swapRate').textContent = '‚ö†Ô∏è Pair not supported by Chainflip';
                return;
            }

            document.getElementById('swapRate').textContent = 'Fetching Chainflip quote...';

            try {
                // Chainflip quote endpoint
                const amountInSmallest = Math.floor(fromAmount * Math.pow(10, swapState.from.decimals || 8));

                const quoteUrl = `${CHAINFLIP_API}?srcChain=${from.chain}&srcAsset=${from.asset}&destChain=${to.chain}&destAsset=${to.asset}&amount=${amountInSmallest}`;

                const response = await fetch(quoteUrl);

                if (!response.ok) {
                    throw new Error(`Chainflip API error: ${response.status}`);
                }

                const quote = await response.json();
                console.log('Chainflip Quote:', quote);

                // Parse response
                const outputAmount = parseInt(quote.egressAmount || quote.estimatedOutput || 0) / Math.pow(10, swapState.to.decimals || 8);
                const rate = outputAmount / fromAmount;

                document.getElementById('toAmount').value = outputAmount.toFixed(outputAmount > 100 ? 2 : 6);
                document.getElementById('swapRate').textContent = `1 ${swapState.from.symbol} ‚âà ${rate.toFixed(4)} ${swapState.to.symbol}`;
                document.getElementById('networkFee').textContent = quote.includedFees ? `~$${quote.includedFees}` : 'Included';

                // Store quote for execution
                swapState.chainflipQuote = quote;

            } catch (error) {
                console.error('Chainflip quote error:', error);
                document.getElementById('swapRate').textContent = 'Chainflip: ' + error.message;
                fallbackQuote(fromAmount);
            }
        }

        async function fetchChangellyQuote(fromAmount) {
            // Changelly uses simple ticker symbols
            const from = swapState.from.token === 'usdt' ? 'usdt' : swapState.from.token;
            const to = swapState.to.token === 'usdt' ? 'usdt' : swapState.to.token;

            document.getElementById('swapRate').textContent = 'Fetching Changelly quote...';

            try {
                // Note: Changelly requires API key for production
                // Using estimation for now
                const fromPrice = swapState.prices[swapState.from.token] || 1;
                const toPrice = swapState.prices[swapState.to.token] || 1;
                const rate = (fromPrice / toPrice) * 0.98; // 2% fee estimate
                const outputAmount = fromAmount * rate;

                document.getElementById('toAmount').value = outputAmount.toFixed(outputAmount > 100 ? 2 : 6);
                document.getElementById('swapRate').textContent =
                    `1 ${swapState.from.symbol} ‚âà ${rate.toFixed(4)} ${swapState.to.symbol} (Changelly estimate)`;
                document.getElementById('networkFee').textContent = '~2% fee';

                // For actual integration, use:
                // POST https://api.changelly.com/v2 with JSON-RPC

                swapState.changellyQuote = { rate, outputAmount };

            } catch (error) {
                console.error('Changelly quote error:', error);
                document.getElementById('swapRate').textContent = 'Changelly: ' + error.message;
                fallbackQuote(fromAmount);
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // TRANSACTION HISTORY - Fetch from Etherscan/Midgard
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const transactionHistory = [];

        async function refreshHistory() {
            if (!swapState.walletAddress) {
                document.getElementById('txHistoryList').innerHTML =
                    '<div class="tx-history-empty">Connect wallet to see transaction history</div>';
                return;
            }

            document.getElementById('txHistoryList').innerHTML =
                '<div class="tx-history-empty">Loading transactions...</div>';

            try {
                // Fetch from multiple sources in parallel
                const [ethTxs, thorTxs] = await Promise.all([
                    fetchEtherscanHistory(),
                    fetchMidgardHistory()
                ]);

                // Combine and sort
                const allTxs = [...ethTxs, ...thorTxs].sort((a, b) => b.timestamp - a.timestamp);

                renderTransactionHistory(allTxs.slice(0, 10)); // Show last 10

            } catch (error) {
                console.error('History fetch error:', error);
                document.getElementById('txHistoryList').innerHTML =
                    '<div class="tx-history-empty">Could not load history</div>';
            }
        }

        async function fetchEtherscanHistory() {
            try {
                // Etherscan API (free tier)
                const url = `https://api.etherscan.io/api?module=account&action=txlist&address=${swapState.walletAddress}&startblock=0&endblock=99999999&page=1&offset=10&sort=desc`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.status !== '1') return [];

                return data.result.map(tx => ({
                    type: tx.from.toLowerCase() === swapState.walletAddress.toLowerCase() ? 'send' : 'receive',
                    hash: tx.hash,
                    amount: (parseInt(tx.value) / 1e18).toFixed(6),
                    symbol: 'ETH',
                    timestamp: parseInt(tx.timeStamp) * 1000,
                    to: tx.to,
                    from: tx.from
                }));

            } catch (error) {
                console.log('Etherscan fetch error:', error);
                return [];
            }
        }

        async function fetchMidgardHistory() {
            try {
                const response = await fetch(`${MIDGARD_API}/actions?address=${swapState.walletAddress}&limit=10`);
                const data = await response.json();

                if (!data.actions) return [];

                return data.actions.map(action => ({
                    type: 'swap',
                    hash: action.in?.[0]?.txID || 'unknown',
                    amount: (parseInt(action.in?.[0]?.coins?.[0]?.amount || 0) / 1e8).toFixed(6),
                    symbol: action.in?.[0]?.coins?.[0]?.asset?.split('.')[1] || 'RUNE',
                    outputAmount: (parseInt(action.out?.[0]?.coins?.[0]?.amount || 0) / 1e8).toFixed(6),
                    outputSymbol: action.out?.[0]?.coins?.[0]?.asset?.split('.')[1] || 'RUNE',
                    timestamp: parseInt(action.date) / 1e6, // nanoseconds to ms
                    status: action.status
                }));

            } catch (error) {
                console.log('Midgard fetch error:', error);
                return [];
            }
        }

        function renderTransactionHistory(transactions) {
            const list = document.getElementById('txHistoryList');

            if (!transactions || transactions.length === 0) {
                list.innerHTML = '<div class="tx-history-empty">No transactions found</div>';
                return;
            }

            list.innerHTML = transactions.map(tx => {
                const icon = tx.type === 'swap' ? 'üîÑ' : (tx.type === 'send' ? '‚Üó' : '‚Üô');
                const iconClass = tx.type === 'swap' ? 'swap' : (tx.type === 'send' ? 'send' : 'receive');
                const timeAgo = formatTimeAgo(tx.timestamp);

                let detail = '';
                if (tx.type === 'swap') {
                    detail = `${tx.amount} ${tx.symbol} ‚Üí ${tx.outputAmount} ${tx.outputSymbol}`;
                } else if (tx.type === 'send') {
                    detail = `To: ${tx.to?.slice(0,8)}...${tx.to?.slice(-6)}`;
                } else {
                    detail = `From: ${tx.from?.slice(0,8)}...${tx.from?.slice(-6)}`;
                }

                return `
                    <div class="tx-history-item" onclick="window.open('https://etherscan.io/tx/${tx.hash}', '_blank')">
                        <div class="tx-history-icon ${iconClass}">${icon}</div>
                        <div class="tx-history-info">
                            <div class="tx-history-type">${tx.type.charAt(0).toUpperCase() + tx.type.slice(1)}</div>
                            <div class="tx-history-detail">${detail}</div>
                        </div>
                        <div class="tx-history-amount">
                            <div class="tx-history-value">${tx.amount} ${tx.symbol}</div>
                            <div class="tx-history-time">${timeAgo}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function formatTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MULTI-WALLET CONNECTIONS - BTC, XTZ, SOL Support
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const walletState = {
            ethereum: { connected: false, address: null, provider: null },
            bitcoin: { connected: false, address: null, provider: null },
            tezos: { connected: false, address: null, provider: null },
            solana: { connected: false, address: null, provider: null }
        };

        async function connectWallet(chain) {
            try {
                switch (chain) {
                    case 'ethereum':
                        await connectEthereumWallet();
                        break;
                    case 'bitcoin':
                        await connectBitcoinWallet();
                        break;
                    case 'tezos':
                        await connectTezosWallet();
                        break;
                    case 'solana':
                        await connectSolanaWallet();
                        break;
                    default:
                        await connectEthereumWallet();
                }

                // Refresh history after connection
                await refreshHistory();

            } catch (error) {
                console.error(`${chain} wallet connection failed:`, error);
                alert(`Failed to connect ${chain} wallet: ${error.message}`);
            }
        }

        async function connectEthereumWallet() {
            if (typeof window.ethereum === 'undefined') {
                window.open('https://metamask.io/download/', '_blank');
                throw new Error('MetaMask not installed');
            }

            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });

            walletState.ethereum.connected = true;
            walletState.ethereum.address = accounts[0];
            walletState.ethereum.provider = window.ethereum;

            // Also update legacy swapState
            swapState.walletConnected = true;
            swapState.walletAddress = accounts[0];

            updateWalletStatusUI('ethereum', accounts[0]);
            updateWalletUI();
            await fetchRealBalances();

            console.log('Ethereum connected:', accounts[0]);
        }

        async function connectBitcoinWallet() {
            // Check for xDefi, Leather, or other BTC wallets
            let btcProvider = null;
            let btcAddress = null;

            // xDefi (formerly XDEFI)
            if (typeof window.xfi?.bitcoin !== 'undefined') {
                btcProvider = 'xDefi';
                try {
                    const accounts = await window.xfi.bitcoin.request({ method: 'request_accounts' });
                    btcAddress = accounts[0];
                } catch (e) {
                    throw new Error('xDefi connection rejected');
                }
            }
            // Leather (formerly Hiro)
            else if (typeof window.btc !== 'undefined') {
                btcProvider = 'Leather';
                try {
                    const response = await window.btc.request('getAddresses');
                    btcAddress = response.result.addresses[0]?.address;
                } catch (e) {
                    throw new Error('Leather connection rejected');
                }
            }
            // Unisat
            else if (typeof window.unisat !== 'undefined') {
                btcProvider = 'Unisat';
                try {
                    const accounts = await window.unisat.requestAccounts();
                    btcAddress = accounts[0];
                } catch (e) {
                    throw new Error('Unisat connection rejected');
                }
            }
            else {
                // Show install options
                const choice = confirm('No Bitcoin wallet detected.\n\nClick OK to install xDefi Wallet (recommended)\nClick Cancel for other options');
                if (choice) {
                    window.open('https://www.xdefi.io/', '_blank');
                } else {
                    alert('Bitcoin wallets:\n\n‚Ä¢ xDefi: xdefi.io\n‚Ä¢ Leather: leather.io\n‚Ä¢ Unisat: unisat.io');
                }
                throw new Error('No Bitcoin wallet installed');
            }

            walletState.bitcoin.connected = true;
            walletState.bitcoin.address = btcAddress;
            walletState.bitcoin.provider = btcProvider;

            updateWalletStatusUI('bitcoin', btcAddress);
            console.log('Bitcoin connected via', btcProvider + ':', btcAddress);

            // Fetch BTC balance
            await fetchBTCBalance(btcAddress);
        }

        async function connectTezosWallet() {
            // Check for Temple or other Tezos wallets
            if (typeof window.tezos === 'undefined') {
                // Try Beacon SDK if available
                if (typeof window.beacon !== 'undefined') {
                    try {
                        const wallet = new window.beacon.DAppClient({ name: 'NFT-8' });
                        const account = await wallet.requestPermissions();
                        walletState.tezos.connected = true;
                        walletState.tezos.address = account.address;
                        walletState.tezos.provider = wallet;
                        updateWalletStatusUI('tezos', account.address);
                        await fetchXTZBalance(account.address);
                        return;
                    } catch (e) {
                        throw new Error('Beacon connection rejected');
                    }
                }

                // No wallet - show install
                const choice = confirm('No Tezos wallet detected.\n\nClick OK to install Temple Wallet');
                if (choice) {
                    window.open('https://templewallet.com/', '_blank');
                }
                throw new Error('Temple wallet not installed');
            }

            try {
                const permissions = await window.tezos.requestPermissions();
                const address = await window.tezos.getPKH();

                walletState.tezos.connected = true;
                walletState.tezos.address = address;
                walletState.tezos.provider = window.tezos;

                updateWalletStatusUI('tezos', address);
                console.log('Tezos connected:', address);

                await fetchXTZBalance(address);

            } catch (e) {
                throw new Error('Temple connection rejected');
            }
        }

        async function connectSolanaWallet() {
            // Check for Phantom or other Solana wallets
            const provider = window.phantom?.solana || window.solana;

            if (!provider?.isPhantom) {
                const choice = confirm('No Solana wallet detected.\n\nClick OK to install Phantom Wallet');
                if (choice) {
                    window.open('https://phantom.app/', '_blank');
                }
                throw new Error('Phantom wallet not installed');
            }

            try {
                const response = await provider.connect();
                const address = response.publicKey.toString();

                walletState.solana.connected = true;
                walletState.solana.address = address;
                walletState.solana.provider = provider;

                updateWalletStatusUI('solana', address);
                console.log('Solana connected:', address);

                await fetchSOLBalance(address);

            } catch (e) {
                throw new Error('Phantom connection rejected');
            }
        }

        function updateWalletStatusUI(chain, address) {
            const statusEl = document.getElementById(`${chain.slice(0,3)}-status`);
            const optionEl = document.getElementById(`wallet-${chain.slice(0,3)}`);

            if (statusEl) {
                const shortAddr = `${address.slice(0,6)}...${address.slice(-4)}`;
                statusEl.textContent = shortAddr;
                statusEl.style.color = 'var(--emerald)';
            }

            if (optionEl) {
                optionEl.classList.add('connected');
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // MULTI-CHAIN BALANCE FETCHING
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        async function fetchBTCBalance(address) {
            try {
                const response = await fetch(`https://blockchain.info/q/addressbalance/${address}`);
                const satoshis = await response.text();
                swapState.balances.btc = parseInt(satoshis) / 1e8;
                updateBalanceUI();
                console.log('BTC balance:', swapState.balances.btc);
            } catch (e) {
                console.log('Could not fetch BTC balance:', e.message);
            }
        }

        async function fetchXTZBalance(address) {
            try {
                const response = await fetch(`https://api.tzkt.io/v1/accounts/${address}/balance`);
                const mutez = await response.json();
                swapState.balances.xtz = mutez / 1e6;
                updateBalanceUI();
                console.log('XTZ balance:', swapState.balances.xtz);
            } catch (e) {
                console.log('Could not fetch XTZ balance:', e.message);
            }
        }

        async function fetchSOLBalance(address) {
            try {
                const response = await fetch('https://api.mainnet-beta.solana.com', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'getBalance',
                        params: [address]
                    })
                });
                const data = await response.json();
                const lamports = data.result?.value || 0;
                swapState.balances.sol = lamports / 1e9;
                console.log('SOL balance:', swapState.balances.sol);
            } catch (e) {
                console.log('Could not fetch SOL balance:', e.message);
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // PROVIDER-AWARE SWAP EXECUTION
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Override initiateSwap to use current provider
        const originalInitiateSwap = initiateSwap;

        initiateSwap = async function() {
            // First, ensure appropriate wallet is connected
            if (!swapState.walletConnected && currentProvider === 'thorchain') {
                const connected = await connectWallet('ethereum');
                if (!connected) return;
            }

            // Check provider support
            const fromToken = swapState.from.token;
            const toToken = swapState.to.token;
            const provider = PROVIDERS[currentProvider];

            if (!provider.supports.includes(fromToken) || !provider.supports.includes(toToken)) {
                alert(`This pair is not supported by ${provider.name}.\n\nTry switching to another provider.`);
                return;
            }

            switch (currentProvider) {
                case 'thorchain':
                    await originalInitiateSwap();
                    break;
                case 'chainflip':
                    await initiateChainflipSwap();
                    break;
                case 'changelly':
                    await initiateChangellySwap();
                    break;
            }
        };

        async function initiateChainflipSwap() {
            const fromAmount = parseFloat(document.getElementById('fromAmount').value);
            if (!fromAmount || !swapState.chainflipQuote) {
                alert('Please enter amount and wait for quote');
                return;
            }

            // Chainflip uses deposit addresses similar to THORChain
            alert(`Chainflip Swap\n\n` +
                `This would initiate a Chainflip swap:\n` +
                `${fromAmount} ${swapState.from.symbol} ‚Üí ${swapState.to.symbol}\n\n` +
                `Chainflip requires API integration for deposit address generation.\n` +
                `Visit: https://chainflip.io for direct swaps.`);
        }

        async function initiateChangellySwap() {
            const fromAmount = parseFloat(document.getElementById('fromAmount').value);
            if (!fromAmount) {
                alert('Please enter amount');
                return;
            }

            // Changelly redirect
            const from = swapState.from.symbol.toLowerCase();
            const to = swapState.to.symbol.toLowerCase();
            const url = `https://changelly.com/exchange/${from}/${to}?amount=${fromAmount}`;

            const proceed = confirm(`Open Changelly?\n\n` +
                `Swap: ${fromAmount} ${swapState.from.symbol} ‚Üí ${swapState.to.symbol}\n\n` +
                `You'll be redirected to Changelly to complete the swap.`);

            if (proceed) {
                window.open(url, '_blank');
            }
        }

        // Auto-refresh history when wallet connects
        const originalConnectEthereumWallet = connectEthereumWallet;
        connectEthereumWallet = async function() {
            await originalConnectEthereumWallet();
            await refreshHistory();
        };

        console.log('üîÑ Multi-provider support: THORChain, Chainflip, Changelly');
        console.log('üíº Multi-wallet support: ETH, BTC, XTZ, SOL');
    </script>
</body>
</html>
