<!--
Reputation Badge Component
==========================
Radio button style with jiggling glowing liquid inside.
4 states with different liquid colors and glow intensities.

Usage:
    {% include 'components/reputation_badge.html' with badge_state='VERIFIED' %}

    Or with JavaScript:
    <div class="reputation-badge" data-state="VERIFIED"></div>
-->

<style>
/* Reputation Badge - Liquid Bubble Style */
.reputation-badge {
    position: relative;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--bg-tertiary, #1a1a24);
    border: 2px solid var(--border-color, #2a2a3a);
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
}

.reputation-badge:hover {
    transform: scale(1.05);
}

/* The liquid container */
.badge-liquid-container {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    overflow: hidden;
    border-radius: 0 0 50% 50%;
}

/* The actual liquid */
.badge-liquid {
    position: relative;
    width: 100%;
    background: linear-gradient(180deg,
        var(--liquid-color-light) 0%,
        var(--liquid-color) 50%,
        var(--liquid-color-dark) 100%
    );
    animation: liquidJiggle 3s ease-in-out infinite;
    border-radius: 0 0 22px 22px;
}

/* Liquid surface wave effect */
.badge-liquid::before {
    content: '';
    position: absolute;
    top: -8px;
    left: -20%;
    width: 140%;
    height: 16px;
    background: radial-gradient(ellipse at center,
        var(--liquid-color-light) 0%,
        transparent 70%
    );
    animation: liquidWave 2s ease-in-out infinite;
    opacity: 0.6;
}

/* Bubble particles */
.badge-bubble {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%,
        rgba(255, 255, 255, 0.8),
        rgba(255, 255, 255, 0.2)
    );
    animation: bubbleRise 4s ease-in-out infinite;
}

.badge-bubble:nth-child(1) {
    width: 4px;
    height: 4px;
    left: 30%;
    animation-delay: 0s;
}

.badge-bubble:nth-child(2) {
    width: 3px;
    height: 3px;
    left: 50%;
    animation-delay: 1s;
}

.badge-bubble:nth-child(3) {
    width: 5px;
    height: 5px;
    left: 70%;
    animation-delay: 2s;
}

/* Glow effect */
.badge-glow {
    position: absolute;
    inset: -4px;
    border-radius: 50%;
    background: var(--glow-color);
    filter: blur(8px);
    opacity: 0;
    animation: glowPulse 2s ease-in-out infinite;
    z-index: -1;
}

/* State indicator ring */
.badge-ring {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    border: 2px solid var(--ring-color);
    opacity: 0.8;
}

/* Label below badge */
.badge-label {
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.55rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ring-color);
    white-space: nowrap;
}

/* =========================================
   STATE: VERIFIED (Green - Excellent)
   Full liquid, strong glow, active bubbles
   ========================================= */
.reputation-badge[data-state="VERIFIED"] {
    --liquid-color: #22c55e;
    --liquid-color-light: #4ade80;
    --liquid-color-dark: #15803d;
    --glow-color: rgba(34, 197, 94, 0.5);
    --ring-color: #22c55e;
}

.reputation-badge[data-state="VERIFIED"] .badge-liquid-container {
    height: 85%;
}

.reputation-badge[data-state="VERIFIED"] .badge-glow {
    opacity: 0.6;
}

/* =========================================
   STATE: ESTABLISHED (Yellow-Green - Good)
   Transitioning from green toward yellow
   ========================================= */
.reputation-badge[data-state="ESTABLISHED"] {
    --liquid-color: #84cc16;           /* Lime green */
    --liquid-color-light: #a3e635;
    --liquid-color-dark: #65a30d;
    --glow-color: rgba(132, 204, 22, 0.4);
    --ring-color: #84cc16;
}

.reputation-badge[data-state="ESTABLISHED"] .badge-liquid-container {
    height: 65%;
}

.reputation-badge[data-state="ESTABLISHED"] .badge-glow {
    opacity: 0.4;
}

/* =========================================
   STATE: EMERGING (Yellow/Amber - Caution)
   Yellow-orange zone
   ========================================= */
.reputation-badge[data-state="EMERGING"] {
    --liquid-color: #eab308;           /* Yellow */
    --liquid-color-light: #facc15;
    --liquid-color-dark: #ca8a04;
    --glow-color: rgba(234, 179, 8, 0.3);
    --ring-color: #eab308;
}

.reputation-badge[data-state="EMERGING"] .badge-liquid-container {
    height: 40%;
}

.reputation-badge[data-state="EMERGING"] .badge-glow {
    opacity: 0.25;
}

.reputation-badge[data-state="EMERGING"] .badge-liquid {
    animation-duration: 4s;
}

/* =========================================
   STATE: UNCERTAIN (Red/Gray - Investigate)
   Minimal liquid, no glow, muted
   ========================================= */
.reputation-badge[data-state="UNCERTAIN"] {
    --liquid-color: #ef4444;           /* Red */
    --liquid-color-light: #f87171;
    --liquid-color-dark: #b91c1c;
    --glow-color: rgba(239, 68, 68, 0.15);
    --ring-color: #6b7280;             /* Gray ring */
}

.reputation-badge[data-state="UNCERTAIN"] .badge-liquid-container {
    height: 15%;
}

.reputation-badge[data-state="UNCERTAIN"] .badge-glow {
    opacity: 0.1;
}

.reputation-badge[data-state="UNCERTAIN"] .badge-liquid {
    animation: liquidJiggle 6s ease-in-out infinite;
    opacity: 0.6;
}

.reputation-badge[data-state="UNCERTAIN"] .badge-bubble {
    opacity: 0.3;
}

/* =========================================
   Animations
   ========================================= */
@keyframes liquidJiggle {
    0%, 100% {
        transform: translateY(0) scaleX(1);
    }
    25% {
        transform: translateY(-2px) scaleX(1.02);
    }
    50% {
        transform: translateY(1px) scaleX(0.98);
    }
    75% {
        transform: translateY(-1px) scaleX(1.01);
    }
}

@keyframes liquidWave {
    0%, 100% {
        transform: translateX(-10%) rotate(-2deg);
    }
    50% {
        transform: translateX(10%) rotate(2deg);
    }
}

@keyframes bubbleRise {
    0% {
        bottom: 10%;
        opacity: 0;
        transform: scale(0.5);
    }
    20% {
        opacity: 0.8;
        transform: scale(1);
    }
    80% {
        opacity: 0.6;
    }
    100% {
        bottom: 90%;
        opacity: 0;
        transform: scale(0.3);
    }
}

@keyframes glowPulse {
    0%, 100% {
        opacity: var(--glow-opacity, 0.4);
        transform: scale(1);
    }
    50% {
        opacity: calc(var(--glow-opacity, 0.4) * 1.5);
        transform: scale(1.1);
    }
}

/* =========================================
   Size Variants
   ========================================= */
.reputation-badge.badge-sm {
    width: 32px;
    height: 32px;
}

.reputation-badge.badge-sm .badge-label {
    font-size: 0.5rem;
    bottom: -16px;
}

.reputation-badge.badge-lg {
    width: 64px;
    height: 64px;
}

.reputation-badge.badge-lg .badge-label {
    font-size: 0.65rem;
    bottom: -24px;
}

.reputation-badge.badge-xl {
    width: 96px;
    height: 96px;
}

.reputation-badge.badge-xl .badge-label {
    font-size: 0.75rem;
    bottom: -28px;
}

/* =========================================
   Tooltip on hover
   ========================================= */
.reputation-badge::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%) scale(0.9);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 0.65rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: all 0.2s ease;
    z-index: 100;
}

.reputation-badge:hover::after {
    opacity: 1;
    transform: translateX(-50%) scale(1);
}

/* =========================================
   Inline variant (for headers/nav)
   ========================================= */
.reputation-badge.badge-inline {
    display: inline-flex;
    vertical-align: middle;
    margin: 0 8px;
}

.reputation-badge.badge-inline .badge-label {
    display: none;
}
</style>

<template id="reputation-badge-template">
    <div class="reputation-badge" data-state="UNCERTAIN" data-tooltip="Reputation badge">
        <!-- Glow effect -->
        <div class="badge-glow"></div>

        <!-- Ring -->
        <div class="badge-ring"></div>

        <!-- Liquid container -->
        <div class="badge-liquid-container">
            <div class="badge-liquid">
                <!-- Bubbles -->
                <div class="badge-bubble"></div>
                <div class="badge-bubble"></div>
                <div class="badge-bubble"></div>
            </div>
        </div>

        <!-- Label -->
        <span class="badge-label"></span>
    </div>
</template>

<script>
/**
 * Reputation Badge Component
 *
 * Creates a liquid-filled radio button style badge
 * with jiggling animation and glow effects.
 */
class ReputationBadge {
    static STATES = {
        VERIFIED: {
            label: 'Verified',
            tooltip: 'High confidence archive - low inconsistency',
            fillPercent: 85
        },
        ESTABLISHED: {
            label: 'Established',
            tooltip: 'Standard archive - normal variance',
            fillPercent: 65
        },
        EMERGING: {
            label: 'Emerging',
            tooltip: 'Building archive - limited data',
            fillPercent: 40
        },
        UNCERTAIN: {
            label: 'Uncertain',
            tooltip: 'Requires investigation',
            fillPercent: 15
        }
    };

    constructor(element) {
        this.element = element;
        this.state = element.dataset.state || 'UNCERTAIN';
        this.init();
    }

    init() {
        // Inject template if not already present
        if (!this.element.querySelector('.badge-liquid-container')) {
            const template = document.getElementById('reputation-badge-template');
            if (template) {
                const clone = template.content.cloneNode(true);
                this.element.innerHTML = '';
                this.element.appendChild(clone.firstElementChild.innerHTML);
            }
        }

        this.updateState(this.state);
    }

    updateState(newState) {
        if (!ReputationBadge.STATES[newState]) {
            console.warn(`Invalid badge state: ${newState}`);
            newState = 'UNCERTAIN';
        }

        this.state = newState;
        this.element.dataset.state = newState;

        const stateConfig = ReputationBadge.STATES[newState];

        // Update label
        const label = this.element.querySelector('.badge-label');
        if (label) {
            label.textContent = stateConfig.label;
        }

        // Update tooltip
        this.element.dataset.tooltip = stateConfig.tooltip;
    }

    // Static method to initialize all badges on page
    static initAll() {
        document.querySelectorAll('.reputation-badge').forEach(el => {
            if (!el._reputationBadge) {
                el._reputationBadge = new ReputationBadge(el);
            }
        });
    }
}

// Auto-initialize on DOM ready
document.addEventListener('DOMContentLoaded', () => {
    ReputationBadge.initAll();
});
</script>

<!--
Example Usage:
==============

Basic badge:
<div class="reputation-badge" data-state="VERIFIED"></div>

With size variant:
<div class="reputation-badge badge-lg" data-state="ESTABLISHED"></div>

Inline in header:
<h1>Artist Name <div class="reputation-badge badge-sm badge-inline" data-state="VERIFIED"></div></h1>

JavaScript update:
document.querySelector('.reputation-badge')._reputationBadge.updateState('EMERGING');
-->
